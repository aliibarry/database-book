<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Server | Sequencing databases in Shiny</title>
  <meta name="description" content="Here we will describe how to build a Shiny app for sequencing data using the code base described in CITE PAPER HERE." />
  <meta name="generator" content="bookdown 0.33 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Server | Sequencing databases in Shiny" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Here we will describe how to build a Shiny app for sequencing data using the code base described in CITE PAPER HERE." />
  <meta name="github-repo" content="aliibarry/omics-database" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Server | Sequencing databases in Shiny" />
  
  <meta name="twitter:description" content="Here we will describe how to build a Shiny app for sequencing data using the code base described in CITE PAPER HERE." />
  

<meta name="author" content="AMB and NZ" />


<meta name="date" content="2023-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ui.html"/>
<link rel="next" href="deploy.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Sequencing databases in Shiny</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> url: your book url like https://bookdown.org/yihui/bookdown</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#shiny"><i class="fa fa-check"></i><b>1.1</b> Shiny</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.2</b> Workflow</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data.html"><a href="data.html"><i class="fa fa-check"></i><b>2</b> Data Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data.html"><a href="data.html#preparation"><i class="fa fa-check"></i><b>2.1</b> Preparation</a></li>
<li class="chapter" data-level="2.2" data-path="data.html"><a href="data.html#species-optional"><i class="fa fa-check"></i><b>2.2</b> Species <em>(optional)</em></a></li>
<li class="chapter" data-level="2.3" data-path="data.html"><a href="data.html#rdata-option-1"><i class="fa fa-check"></i><b>2.3</b> RData <em>(option 1)</em></a></li>
<li class="chapter" data-level="2.4" data-path="data.html"><a href="data.html#building-an-sql-database-via-r-recommended"><i class="fa fa-check"></i><b>2.4</b> Building an SQL database via R <em>(recommended)</em></a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="data.html"><a href="data.html#sql-manipulation"><i class="fa fa-check"></i><b>2.4.1</b> SQL manipulation</a></li>
<li class="chapter" data-level="2.4.2" data-path="data.html"><a href="data.html#processing-multiple-files"><i class="fa fa-check"></i><b>2.4.2</b> Processing multiple files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="ui.html"><a href="ui.html"><i class="fa fa-check"></i><b>3</b> User Interface</a>
<ul>
<li class="chapter" data-level="3.1" data-path="ui.html"><a href="ui.html#basic-structure"><i class="fa fa-check"></i><b>3.1</b> Basic structure</a></li>
<li class="chapter" data-level="3.2" data-path="ui.html"><a href="ui.html#header"><i class="fa fa-check"></i><b>3.2</b> Header</a></li>
<li class="chapter" data-level="3.3" data-path="ui.html"><a href="ui.html#styling"><i class="fa fa-check"></i><b>3.3</b> Styling</a></li>
<li class="chapter" data-level="3.4" data-path="ui.html"><a href="ui.html#sidebar"><i class="fa fa-check"></i><b>3.4</b> Sidebar</a></li>
<li class="chapter" data-level="3.5" data-path="ui.html"><a href="ui.html#body"><i class="fa fa-check"></i><b>3.5</b> Body</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="ui.html"><a href="ui.html#homepage"><i class="fa fa-check"></i><b>3.5.1</b> Homepage</a></li>
<li class="chapter" data-level="3.5.2" data-path="ui.html"><a href="ui.html#grouped-comparisons"><i class="fa fa-check"></i><b>3.5.2</b> Grouped comparisons</a></li>
<li class="chapter" data-level="3.5.3" data-path="ui.html"><a href="ui.html#individual-analysis"><i class="fa fa-check"></i><b>3.5.3</b> Individual Analysis</a></li>
<li class="chapter" data-level="3.5.4" data-path="ui.html"><a href="ui.html#network-page"><i class="fa fa-check"></i><b>3.5.4</b> Network page</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="server.html"><a href="server.html"><i class="fa fa-check"></i><b>4</b> Server</a>
<ul>
<li class="chapter" data-level="4.1" data-path="server.html"><a href="server.html#requirements"><i class="fa fa-check"></i><b>4.1</b> Requirements</a></li>
<li class="chapter" data-level="4.2" data-path="server.html"><a href="server.html#server-overview"><i class="fa fa-check"></i><b>4.2</b> Server Overview</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="server.html"><a href="server.html#side-bar"><i class="fa fa-check"></i><b>4.2.1</b> Side bar</a></li>
<li class="chapter" data-level="4.2.2" data-path="server.html"><a href="server.html#tab-menu"><i class="fa fa-check"></i><b>4.2.2</b> Tab Menu</a></li>
<li class="chapter" data-level="4.2.3" data-path="server.html"><a href="server.html#grouped-comparisons-1"><i class="fa fa-check"></i><b>4.2.3</b> Grouped comparisons</a></li>
<li class="chapter" data-level="4.2.4" data-path="server.html"><a href="server.html#individual-analysis-1"><i class="fa fa-check"></i><b>4.2.4</b> Individual Analysis</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="server.html"><a href="server.html#network-analysis"><i class="fa fa-check"></i><b>4.3</b> Network Analysis</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="server.html"><a href="server.html#integration-with-string-db"><i class="fa fa-check"></i><b>4.3.1</b> Integration with STRING DB</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="server.html"><a href="server.html#functions"><i class="fa fa-check"></i><b>4.4</b> Functions</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="server.html"><a href="server.html#data-processing"><i class="fa fa-check"></i><b>4.4.1</b> Data processing</a></li>
<li class="chapter" data-level="4.4.2" data-path="server.html"><a href="server.html#dot-plots"><i class="fa fa-check"></i><b>4.4.2</b> Dot plots</a></li>
<li class="chapter" data-level="4.4.3" data-path="server.html"><a href="server.html#line-plots"><i class="fa fa-check"></i><b>4.4.3</b> Line plots</a></li>
<li class="chapter" data-level="4.4.4" data-path="server.html"><a href="server.html#a-differential-expression-dot-plot"><i class="fa fa-check"></i><b>4.4.4</b> A differential expression dot plot</a></li>
<li class="chapter" data-level="4.4.5" data-path="server.html"><a href="server.html#a-volcano-plot"><i class="fa fa-check"></i><b>4.4.5</b> A volcano plot</a></li>
<li class="chapter" data-level="4.4.6" data-path="server.html"><a href="server.html#other"><i class="fa fa-check"></i><b>4.4.6</b> Other</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="deploy.html"><a href="deploy.html"><i class="fa fa-check"></i><b>5</b> Deploying your application</a>
<ul>
<li class="chapter" data-level="5.1" data-path="deploy.html"><a href="deploy.html#shinyapps.io"><i class="fa fa-check"></i><b>5.1</b> Shinyapps.io</a></li>
<li class="chapter" data-level="5.2" data-path="deploy.html"><a href="deploy.html#bioconductor"><i class="fa fa-check"></i><b>5.2</b> Bioconductor</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="trouble.html"><a href="trouble.html"><i class="fa fa-check"></i><b>6</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="6.1" data-path="trouble.html"><a href="trouble.html#package-installation"><i class="fa fa-check"></i><b>6.1</b> Package installation</a></li>
<li class="chapter" data-level="6.2" data-path="trouble.html"><a href="trouble.html#file-setup"><i class="fa fa-check"></i><b>6.2</b> File setup</a></li>
<li class="chapter" data-level="6.3" data-path="trouble.html"><a href="trouble.html#styling-1"><i class="fa fa-check"></i><b>6.3</b> Styling</a></li>
<li class="chapter" data-level="6.4" data-path="trouble.html"><a href="trouble.html#data-inputoutput-issues"><i class="fa fa-check"></i><b>6.4</b> Data input/output issues</a></li>
<li class="chapter" data-level="6.5" data-path="trouble.html"><a href="trouble.html#debugging-reactive-code"><i class="fa fa-check"></i><b>6.5</b> Debugging reactive code</a></li>
<li class="chapter" data-level="6.6" data-path="trouble.html"><a href="trouble.html#deployment"><i class="fa fa-check"></i><b>6.6</b> Deployment</a>
<ul>
<li class="chapter" data-level="6.6.1" data-path="trouble.html"><a href="trouble.html#basics"><i class="fa fa-check"></i><b>6.6.1</b> Basics</a></li>
<li class="chapter" data-level="6.6.2" data-path="trouble.html"><a href="trouble.html#bioconductor-1"><i class="fa fa-check"></i><b>6.6.2</b> Bioconductor</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Sequencing databases in Shiny</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="server" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">Chapter 4</span> Server<a href="server.html#server" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<style>
img
{
    display:block;
    float:none;
    margin-left:auto;
    margin-right:auto;
}
</style>
<p>Once you:<br />
1. Have created a dataset description <code>des_df</code> object<br />
2. Have changed the directory of the <code>.db</code> to the one you have stored your data in</p>
<p>…you can start running the app.</p>
<p><em>(but lots of details are provided below so you can dive into the code)</em></p>
<div id="requirements" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Requirements<a href="server.html#requirements" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For the <code>Server.R</code> page to run, you will need to create a <code>des_df</code>, a description df that describes your datasets. An example is shown below:</p>
<ul>
<li><strong>Dataset</strong>: The name of the dataset</li>
<li><strong>condition</strong>: The experimental disease group name</li>
<li><strong>species</strong>: the species in the experiment</li>
<li><strong>count</strong>: the name of the count matrix</li>
<li><strong>colDatas</strong>: The name of experimental design</li>
<li><strong>deg_df_name</strong>: the name of differential expression data</li>
<li><strong>type</strong>: Name of the RNA sequencing technique; either bulk or single</li>
<li><strong>page_id</strong>: This identifier is useful for loading description files specific for each experiment. E.g. subtype.Rhtml . Name your description files and add their names to this column.</li>
<li><strong>include_subtypes</strong>: This specifies if there are different subtypes of samples in the experiment. E.g. different species strains. If TRUE, there will be an additional line plot showing subtype-specific changes in gene expression.</li>
<li><strong>include_degs</strong>: This specifies if there are differential expression data files for this experiment. If TRUE, the visualisation page will yield differential expression dot plots and volcano plots.</li>
</ul>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="server.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### example with one bulk dataset</span></span>
<span id="cb1-2"><a href="server.html#cb1-2" aria-hidden="true" tabindex="-1"></a>des_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-3"><a href="server.html#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">&quot;Subtype DRG (Barry)&quot;</span>),</span>
<span id="cb1-4"><a href="server.html#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;ipsi&quot;</span>),</span>
<span id="cb1-5"><a href="server.html#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="st">&quot;mouse&quot;</span>),</span>
<span id="cb1-6"><a href="server.html#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="st">&quot;bulkseq_mat&quot;</span>),</span>
<span id="cb1-7"><a href="server.html#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_subtypes =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>),</span>
<span id="cb1-8"><a href="server.html#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_degs =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>),</span>
<span id="cb1-9"><a href="server.html#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_id =</span> <span class="fu">c</span>(<span class="st">&quot;subtype&quot;</span>),</span>
<span id="cb1-10"><a href="server.html#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">deg_df_name =</span> <span class="fu">c</span>(<span class="st">&quot;subtype_deg_df&quot;</span>),</span>
<span id="cb1-11"><a href="server.html#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">colDatas =</span> <span class="fu">c</span>(<span class="st">&quot;bulkseq_colData&quot;</span>),</span>
<span id="cb1-12"><a href="server.html#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;bulk&quot;</span>),</span>
<span id="cb1-13"><a href="server.html#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tissue =</span> <span class="fu">c</span>(<span class="st">&quot;DRG&quot;</span>))</span>
<span id="cb1-14"><a href="server.html#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="server.html#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">### example with bulk and single cell datasets</span></span>
<span id="cb1-16"><a href="server.html#cb1-16" aria-hidden="true" tabindex="-1"></a>des_df <span class="ot">=</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-17"><a href="server.html#cb1-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">Dataset =</span> <span class="fu">c</span>(<span class="st">&quot;Subtype DRG (Barry)&quot;</span>, <span class="st">&quot;Mouse DRG Bulk&quot;</span>, <span class="st">&quot;Human DRG spatial-seq&quot;</span>),</span>
<span id="cb1-18"><a href="server.html#cb1-18" aria-hidden="true" tabindex="-1"></a>  <span class="at">condition =</span> <span class="fu">c</span>(<span class="st">&quot;ipsi&quot;</span>, <span class="st">&quot;SNI&quot;</span>, <span class="st">&quot;N/A&quot;</span>),</span>
<span id="cb1-19"><a href="server.html#cb1-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">Species =</span> <span class="fu">c</span>(<span class="st">&quot;mouse&quot;</span>, <span class="st">&quot;mouse&quot;</span>, <span class="st">&quot;human&quot;</span>),</span>
<span id="cb1-20"><a href="server.html#cb1-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">count =</span> <span class="fu">c</span>(<span class="st">&quot;bulkseq_mat&quot;</span>, <span class="st">&quot;TPM_mouse&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb1-21"><a href="server.html#cb1-21" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_subtypes =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">FALSE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb1-22"><a href="server.html#cb1-22" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_degs =</span> <span class="fu">c</span>(<span class="cn">TRUE</span>, <span class="cn">TRUE</span>, <span class="cn">FALSE</span>),</span>
<span id="cb1-23"><a href="server.html#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">page_id =</span> <span class="fu">c</span>(<span class="st">&quot;subtype&quot;</span>, <span class="st">&quot;mouse&quot;</span>, <span class="st">&quot;scrna&quot;</span>),</span>
<span id="cb1-24"><a href="server.html#cb1-24" aria-hidden="true" tabindex="-1"></a>  <span class="at">deg_df_name =</span> <span class="fu">c</span>(<span class="st">&quot;subtype_deg_df&quot;</span>, <span class="st">&quot;mouse_deg_df&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb1-25"><a href="server.html#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="at">colDatas =</span> <span class="fu">c</span>(<span class="st">&quot;bulkseq_colData&quot;</span>, <span class="st">&quot;TPM_mouse_colData&quot;</span>, <span class="st">&quot;&quot;</span>),</span>
<span id="cb1-26"><a href="server.html#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">c</span>(<span class="st">&quot;bulk&quot;</span>,<span class="st">&quot;bulk&quot;</span>, <span class="st">&quot;single&quot;</span>),</span>
<span id="cb1-27"><a href="server.html#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="at">Tissue =</span> <span class="fu">c</span>(<span class="st">&quot;DRG&quot;</span>, <span class="st">&quot;DRG&quot;</span>, <span class="st">&quot;DRG&quot;</span>))</span>
<span id="cb1-28"><a href="server.html#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="server.html#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="server.html#cb1-30" aria-hidden="true" tabindex="-1"></a><span class="fu">kbl</span>(des_df <span class="sc">%&gt;%</span> head) <span class="sc">%&gt;%</span> <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>, <span class="st">&quot;condensed&quot;</span>, <span class="st">&quot;responsive&quot;</span>), <span class="at">font_size =</span> <span class="dv">12</span>, <span class="at">latex_options =</span> <span class="st">&quot;scale_down&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">scroll_box</span>(<span class="at">width =</span> <span class="st">&quot;100%&quot;</span>, <span class="at">height =</span> <span class="st">&quot;500px&quot;</span>)</span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 0px; overflow-y: scroll; height:500px; overflow-x: scroll; width:100%; ">
<table class="table table-striped table-hover table-condensed table-responsive" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Dataset
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
condition
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Species
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
count
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
include_subtypes
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
include_degs
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
page_id
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
deg_df_name
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
colDatas
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
type
</th>
<th style="text-align:left;position: sticky; top:0; background-color: #FFFFFF;">
Tissue
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Subtype DRG (Barry)
</td>
<td style="text-align:left;">
ipsi
</td>
<td style="text-align:left;">
mouse
</td>
<td style="text-align:left;">
bulkseq_mat
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
subtype
</td>
<td style="text-align:left;">
subtype_deg_df
</td>
<td style="text-align:left;">
bulkseq_colData
</td>
<td style="text-align:left;">
bulk
</td>
<td style="text-align:left;">
DRG
</td>
</tr>
<tr>
<td style="text-align:left;">
Mouse DRG Bulk
</td>
<td style="text-align:left;">
SNI
</td>
<td style="text-align:left;">
mouse
</td>
<td style="text-align:left;">
TPM_mouse
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
TRUE
</td>
<td style="text-align:left;">
mouse
</td>
<td style="text-align:left;">
mouse_deg_df
</td>
<td style="text-align:left;">
TPM_mouse_colData
</td>
<td style="text-align:left;">
bulk
</td>
<td style="text-align:left;">
DRG
</td>
</tr>
<tr>
<td style="text-align:left;">
Human DRG spatial-seq
</td>
<td style="text-align:left;">
N/A
</td>
<td style="text-align:left;">
human
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
FALSE
</td>
<td style="text-align:left;">
scrna
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
</td>
<td style="text-align:left;">
single
</td>
<td style="text-align:left;">
DRG
</td>
</tr>
</tbody>
</table>
</div>
<p> </p>
<p>The table names of <code>countdata</code> and <code>colData</code> for each experiment will be written. This allows the app to directly query those tables from the database object. In addition, you will need to specify directory that storing your data</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="server.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="do">## directory for scRNA sequencing data;  </span></span>
<span id="cb2-2"><a href="server.html#cb2-2" aria-hidden="true" tabindex="-1"></a>{</span>
<span id="cb2-3"><a href="server.html#cb2-3" aria-hidden="true" tabindex="-1"></a>  scRNA_dir   <span class="ot">=</span> <span class="cn">NULL</span> <span class="co"># leave it for NULL if none</span></span>
<span id="cb2-4"><a href="server.html#cb2-4" aria-hidden="true" tabindex="-1"></a>  scRNA_names <span class="ot">=</span> <span class="cn">NULL</span> <span class="co"># leave it for NULL if none</span></span>
<span id="cb2-5"><a href="server.html#cb2-5" aria-hidden="true" tabindex="-1"></a>  scRNA_dir <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb2-6"><a href="server.html#cb2-6" aria-hidden="true" tabindex="-1"></a>  scRNA_dir <span class="ot">=</span> <span class="fu">c</span>(scRNA_dir, <span class="fu">list</span>(<span class="st">&quot;drg.combined.rds&quot;</span>)) <span class="co">#set for single  cell data</span></span>
<span id="cb2-7"><a href="server.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  scRNA_names <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Human DRG spatial-seq&quot;</span>) <span class="co">#names for single  cell data</span></span>
<span id="cb2-8"><a href="server.html#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="server.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(scRNA_dir) <span class="ot">=</span> scRNA_names</span>
<span id="cb2-10"><a href="server.html#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="server.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">length</span>(scRNA_dir) <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb2-12"><a href="server.html#cb2-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">library</span>(Seurat) <span class="co"># for scRNA; only load library if scRNA data is present</span></span>
<span id="cb2-13"><a href="server.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb2-14"><a href="server.html#cb2-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-15"><a href="server.html#cb2-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-16"><a href="server.html#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="do">## RData that contains DEG files for network analysis </span></span>
<span id="cb2-17"><a href="server.html#cb2-17" aria-hidden="true" tabindex="-1"></a>network_dir <span class="ot">=</span> <span class="st">&quot;data/network.RData&quot;</span></span>
<span id="cb2-18"><a href="server.html#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="server.html#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="do">## directory for the sql database </span></span>
<span id="cb2-20"><a href="server.html#cb2-20" aria-hidden="true" tabindex="-1"></a>sql_dir <span class="ot">=</span> <span class="st">&quot;test.db&quot;</span></span></code></pre></div>
</div>
<div id="server-overview" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Server Overview<a href="server.html#server-overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>You don’t need to modify this, but is provided as an overview of the app structure</em>.</p>
<p><code>server()</code> function is invoked each time a new session starts. When the server function is called it creates a new local environment that is independent of every other invocation of the function. This allows each session to have a unique state, as well as isolating the variables created inside the function.</p>
<p>Server functions take three parameters: <code>input</code>, <code>output</code>, and <code>session</code>. The input argument is a list-like object that contains all the input data sent from <code>ui.R</code>, named according to the input ID.</p>
<div id="side-bar" class="section level3 hasAnchor" number="4.2.1">
<h3><span class="header-section-number">4.2.1</span> Side bar<a href="server.html#side-bar" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Update the gene symbols entered or uploaded in files into reactive variables.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="server.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># gene search bar</span></span>
<span id="cb3-2"><a href="server.html#cb3-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">updateSelectizeInput</span>(session,</span>
<span id="cb3-3"><a href="server.html#cb3-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">inputId =</span> <span class="st">&quot;geneid&quot;</span>,</span>
<span id="cb3-4"><a href="server.html#cb3-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">label =</span> <span class="st">&quot;Search Genes:&quot;</span>,</span>
<span id="cb3-5"><a href="server.html#cb3-5" aria-hidden="true" tabindex="-1"></a>                          <span class="at">choices =</span> allgenes,</span>
<span id="cb3-6"><a href="server.html#cb3-6" aria-hidden="true" tabindex="-1"></a>                          <span class="at">server =</span> <span class="cn">TRUE</span>,</span>
<span id="cb3-7"><a href="server.html#cb3-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;Tubb3&quot;</span>,<span class="st">&quot;Gap43&quot;</span>,<span class="st">&quot;Atf3&quot;</span>) <span class="do">## can change to relevant genes</span></span>
<span id="cb3-8"><a href="server.html#cb3-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-9"><a href="server.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-10"><a href="server.html#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># a reactive variable that records whether a file is uploaded.</span></span>
<span id="cb3-11"><a href="server.html#cb3-11" aria-hidden="true" tabindex="-1"></a>rv <span class="ot">&lt;-</span> <span class="fu">reactiveValues</span>(</span>
<span id="cb3-12"><a href="server.html#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">clear =</span> <span class="cn">FALSE</span>,</span>
<span id="cb3-13"><a href="server.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> <span class="cn">FALSE</span></span>
<span id="cb3-14"><a href="server.html#cb3-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb3-15"><a href="server.html#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="server.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># read in files uploaded </span></span>
<span id="cb3-17"><a href="server.html#cb3-17" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observeEvent</span>(input<span class="sc">$</span>file, {</span>
<span id="cb3-18"><a href="server.html#cb3-18" aria-hidden="true" tabindex="-1"></a>  rv<span class="sc">$</span>clear <span class="ot">&lt;-</span> <span class="cn">FALSE</span></span>
<span id="cb3-19"><a href="server.html#cb3-19" aria-hidden="true" tabindex="-1"></a>  rv<span class="sc">$</span>data <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-20"><a href="server.html#cb3-20" aria-hidden="true" tabindex="-1"></a>}, <span class="at">priority =</span> <span class="dv">1000</span>)</span>
<span id="cb3-21"><a href="server.html#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="server.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># clear the file space when files are removed</span></span>
<span id="cb3-23"><a href="server.html#cb3-23" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observeEvent</span>(input<span class="sc">$</span>reset, {</span>
<span id="cb3-24"><a href="server.html#cb3-24" aria-hidden="true" tabindex="-1"></a>  rv<span class="sc">$</span>clear <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb3-25"><a href="server.html#cb3-25" aria-hidden="true" tabindex="-1"></a>  rv<span class="sc">$</span>data <span class="ot">=</span> <span class="cn">FALSE</span></span>
<span id="cb3-26"><a href="server.html#cb3-26" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-27"><a href="server.html#cb3-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-28"><a href="server.html#cb3-28" aria-hidden="true" tabindex="-1"></a><span class="co"># read into gene ids from files</span></span>
<span id="cb3-29"><a href="server.html#cb3-29" aria-hidden="true" tabindex="-1"></a>file_input <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb3-30"><a href="server.html#cb3-30" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (rv<span class="sc">$</span>clear <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-31"><a href="server.html#cb3-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb3-32"><a href="server.html#cb3-32" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-33"><a href="server.html#cb3-33" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(rv<span class="sc">$</span>clear<span class="sc">==</span><span class="cn">FALSE</span> <span class="sc">&amp;&amp;</span> rv<span class="sc">$</span>data <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb3-34"><a href="server.html#cb3-34" aria-hidden="true" tabindex="-1"></a>    goi <span class="ot">=</span> <span class="fu">read.table</span>(input<span class="sc">$</span>file<span class="sc">$</span>datapath)</span>
<span id="cb3-35"><a href="server.html#cb3-35" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rownames</span>(goi) <span class="ot">&lt;-</span> goi[,<span class="dv">1</span>]</span>
<span id="cb3-36"><a href="server.html#cb3-36" aria-hidden="true" tabindex="-1"></a>    goi <span class="ot">&lt;-</span> goi[<span class="fu">which</span>(<span class="fu">rownames</span>(goi) <span class="sc">%in%</span> allgenes<span class="sc">==</span><span class="cn">TRUE</span>),]</span>
<span id="cb3-37"><a href="server.html#cb3-37" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(goi)}</span>
<span id="cb3-38"><a href="server.html#cb3-38" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb3-39"><a href="server.html#cb3-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-40"><a href="server.html#cb3-40" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">=</span> <span class="fu">reactive</span>({</span>
<span id="cb3-41"><a href="server.html#cb3-41" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">file_input</span>())) {</span>
<span id="cb3-42"><a href="server.html#cb3-42" aria-hidden="true" tabindex="-1"></a>    genes <span class="ot">=</span> input<span class="sc">$</span>geneid</span>
<span id="cb3-43"><a href="server.html#cb3-43" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-44"><a href="server.html#cb3-44" aria-hidden="true" tabindex="-1"></a>  <span class="cf">else</span> {</span>
<span id="cb3-45"><a href="server.html#cb3-45" aria-hidden="true" tabindex="-1"></a>    genes <span class="ot">=</span> <span class="fu">file_input</span>()</span>
<span id="cb3-46"><a href="server.html#cb3-46" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb3-47"><a href="server.html#cb3-47" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="tab-menu" class="section level3 hasAnchor" number="4.2.2">
<h3><span class="header-section-number">4.2.2</span> Tab Menu<a href="server.html#tab-menu" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Update active tab based on the current selection of a tab menu.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="server.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="do">### this doesn&#39;t need to be modified</span></span>
<span id="cb4-2"><a href="server.html#cb4-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observeEvent</span>(input<span class="sc">$</span>metaa, {</span>
<span id="cb4-3"><a href="server.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  Newtab <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>tabs, <span class="st">&quot;tabhome&quot;</span> <span class="ot">=</span> <span class="st">&quot;tabmeta&quot;</span>)</span>
<span id="cb4-4"><a href="server.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  shinydashboard<span class="sc">::</span><span class="fu">updateTabItems</span>(session, <span class="st">&quot;tabs&quot;</span>, Newtab) </span>
<span id="cb4-5"><a href="server.html#cb4-5" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-6"><a href="server.html#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="server.html#cb4-7" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observeEvent</span>(input<span class="sc">$</span>inda, {</span>
<span id="cb4-8"><a href="server.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  Newtab <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>tabs,<span class="st">&quot;tabhome&quot;</span> <span class="ot">=</span> <span class="st">&quot;tabdata&quot;</span>)</span>
<span id="cb4-9"><a href="server.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  shinydashboard<span class="sc">::</span><span class="fu">updateTabItems</span>(session, <span class="st">&quot;tabs&quot;</span>, Newtab) </span>
<span id="cb4-10"><a href="server.html#cb4-10" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb4-11"><a href="server.html#cb4-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-12"><a href="server.html#cb4-12" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observeEvent</span>(input<span class="sc">$</span>neta, {</span>
<span id="cb4-13"><a href="server.html#cb4-13" aria-hidden="true" tabindex="-1"></a>  Newtab <span class="ot">&lt;-</span> <span class="cf">switch</span>(input<span class="sc">$</span>tabs,<span class="st">&quot;tabhome&quot;</span> <span class="ot">=</span> <span class="st">&quot;tabnet&quot;</span>)</span>
<span id="cb4-14"><a href="server.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  shinydashboard<span class="sc">::</span><span class="fu">updateTabItems</span>(session, <span class="st">&quot;tabs&quot;</span>, Newtab) </span>
<span id="cb4-15"><a href="server.html#cb4-15" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="grouped-comparisons-1" class="section level3 hasAnchor" number="4.2.3">
<h3><span class="header-section-number">4.2.3</span> Grouped comparisons<a href="server.html#grouped-comparisons-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>By using the same visualization tools and methods across studies, it becomes easier to compare and integrate results from different studies.</p>
<p><img src="data/Images/meta.png" width="3614" /></p>
<ol style="list-style-type: decimal">
<li>Render a table for datasets included</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="server.html#cb5-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>meta_table <span class="ot">=</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb5-2"><a href="server.html#cb5-2" aria-hidden="true" tabindex="-1"></a>    DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb5-3"><a href="server.html#cb5-3" aria-hidden="true" tabindex="-1"></a>      bulk_df[<span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Pain_Model&quot;</span>, <span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Tissue&quot;</span>)], <span class="do">## can select relevant columns</span></span>
<span id="cb5-4"><a href="server.html#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb5-5"><a href="server.html#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">&#39;nowrap&#39;</span>,</span>
<span id="cb5-6"><a href="server.html#cb5-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">scrollY =</span> <span class="cn">TRUE</span>, <span class="at">pageLength =</span> <span class="dv">5</span>), </span>
<span id="cb5-7"><a href="server.html#cb5-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">selection =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb5-8"><a href="server.html#cb5-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># selection = list(mode = &quot;multiple&quot;, selected = list(rows = c(1:nrow(bulk_df)), cols = c(1:4)), target = &quot;row+column&quot;)</span></span>
<span id="cb5-9"><a href="server.html#cb5-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-10"><a href="server.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Generate homepage plots</li>
</ol>
<ul>
<li>A combined gene expression dot plots</li>
<li>A scRNA dotplot based on a <code>Seurat</code> object</li>
<li>A differential expression dot plot that allows visualisation of the significance level of differential gene expression</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="server.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="do">### this doesn&#39;t need to be modified</span></span>
<span id="cb6-2"><a href="server.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># plot in reponse to the &#39;load&#39; button </span></span>
<span id="cb6-3"><a href="server.html#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>load, {</span>
<span id="cb6-4"><a href="server.html#cb6-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-5"><a href="server.html#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># load scRNA data if it exists </span></span>
<span id="cb6-6"><a href="server.html#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(scRNA_dir) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb6-7"><a href="server.html#cb6-7" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (c <span class="cf">in</span> scRNA_dir) {</span>
<span id="cb6-8"><a href="server.html#cb6-8" aria-hidden="true" tabindex="-1"></a>        variables<span class="sc">$</span>pbmc <span class="ot">&lt;-</span> <span class="fu">c</span>(variables<span class="sc">$</span>pbmc, <span class="fu">readRDS</span>(scRNA_dir[[<span class="dv">1</span>]]))</span>
<span id="cb6-9"><a href="server.html#cb6-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-10"><a href="server.html#cb6-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">names</span>(variables<span class="sc">$</span>pbmc) <span class="ot">=</span> scRNA_names</span>
<span id="cb6-11"><a href="server.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-12"><a href="server.html#cb6-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-13"><a href="server.html#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read geneids from file if it exists </span></span>
<span id="cb6-14"><a href="server.html#cb6-14" aria-hidden="true" tabindex="-1"></a>    file_input <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb6-15"><a href="server.html#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (rv<span class="sc">$</span>clear <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb6-16"><a href="server.html#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb6-17"><a href="server.html#cb6-17" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-18"><a href="server.html#cb6-18" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(rv<span class="sc">$</span>clear<span class="sc">==</span><span class="cn">FALSE</span> <span class="sc">&amp;&amp;</span> rv<span class="sc">$</span>data <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb6-19"><a href="server.html#cb6-19" aria-hidden="true" tabindex="-1"></a>        goi <span class="ot">=</span> <span class="fu">read.table</span>(input<span class="sc">$</span>file<span class="sc">$</span>datapath)</span>
<span id="cb6-20"><a href="server.html#cb6-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rownames</span>(goi) <span class="ot">&lt;-</span> goi[,<span class="dv">1</span>]</span>
<span id="cb6-21"><a href="server.html#cb6-21" aria-hidden="true" tabindex="-1"></a>        goi <span class="ot">&lt;-</span> goi[<span class="fu">which</span>(<span class="fu">rownames</span>(goi) <span class="sc">%in%</span> allgenes<span class="sc">==</span><span class="cn">TRUE</span>),]</span>
<span id="cb6-22"><a href="server.html#cb6-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(goi)}</span>
<span id="cb6-23"><a href="server.html#cb6-23" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb6-24"><a href="server.html#cb6-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-25"><a href="server.html#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(<span class="fu">file_input</span>())) {</span>
<span id="cb6-26"><a href="server.html#cb6-26" aria-hidden="true" tabindex="-1"></a>      genes <span class="ot">=</span> input<span class="sc">$</span>geneid</span>
<span id="cb6-27"><a href="server.html#cb6-27" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-28"><a href="server.html#cb6-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb6-29"><a href="server.html#cb6-29" aria-hidden="true" tabindex="-1"></a>      genes <span class="ot">=</span> <span class="fu">file_input</span>()</span>
<span id="cb6-30"><a href="server.html#cb6-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-31"><a href="server.html#cb6-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-32"><a href="server.html#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># plot homepage dot plots and DEG plots</span></span>
<span id="cb6-33"><a href="server.html#cb6-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">nrow</span>(bulk_df) <span class="sc">!=</span> <span class="dv">0</span>) {</span>
<span id="cb6-34"><a href="server.html#cb6-34" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-35"><a href="server.html#cb6-35" aria-hidden="true" tabindex="-1"></a>      <span class="co"># include all bulk datasets in the combined plots</span></span>
<span id="cb6-36"><a href="server.html#cb6-36" aria-hidden="true" tabindex="-1"></a>      selected_data <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bulk_df))</span>
<span id="cb6-37"><a href="server.html#cb6-37" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-38"><a href="server.html#cb6-38" aria-hidden="true" tabindex="-1"></a>      df_list <span class="ot">=</span> <span class="fu">list</span>()</span>
<span id="cb6-39"><a href="server.html#cb6-39" aria-hidden="true" tabindex="-1"></a>      <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(bulk_df))){</span>
<span id="cb6-40"><a href="server.html#cb6-40" aria-hidden="true" tabindex="-1"></a>        curr <span class="ot">=</span> bulk_df[i,]</span>
<span id="cb6-41"><a href="server.html#cb6-41" aria-hidden="true" tabindex="-1"></a>        d <span class="ot">=</span> curr<span class="sc">$</span>count</span>
<span id="cb6-42"><a href="server.html#cb6-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-43"><a href="server.html#cb6-43" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if using sql </span></span>
<span id="cb6-44"><a href="server.html#cb6-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(sql_dir)) {</span>
<span id="cb6-45"><a href="server.html#cb6-45" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (curr<span class="sc">$</span>Species <span class="sc">==</span> <span class="st">&quot;human&quot;</span>){</span>
<span id="cb6-46"><a href="server.html#cb6-46" aria-hidden="true" tabindex="-1"></a>            sql <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;SELECT * FROM&quot;</span>, d, <span class="st">&quot;WHERE mgi_symbol = ?&quot;</span>)</span>
<span id="cb6-47"><a href="server.html#cb6-47" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb6-48"><a href="server.html#cb6-48" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> {</span>
<span id="cb6-49"><a href="server.html#cb6-49" aria-hidden="true" tabindex="-1"></a>            sql <span class="ot">=</span> <span class="fu">paste</span>(<span class="st">&quot;SELECT * FROM&quot;</span>, d, <span class="st">&quot;WHERE symbol = ?&quot;</span>)</span>
<span id="cb6-50"><a href="server.html#cb6-50" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb6-51"><a href="server.html#cb6-51" aria-hidden="true" tabindex="-1"></a>          count_data <span class="ot">=</span> <span class="fu">as.data.frame</span>(<span class="fu">dbGetPreparedQuery</span>(conn, sql, <span class="at">bind.data=</span><span class="fu">data.frame</span>(<span class="at">symbol=</span>genes)))</span>
<span id="cb6-52"><a href="server.html#cb6-52" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-53"><a href="server.html#cb6-53" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-54"><a href="server.html#cb6-54" aria-hidden="true" tabindex="-1"></a>        <span class="co"># if using RData</span></span>
<span id="cb6-55"><a href="server.html#cb6-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="sc">!</span><span class="fu">is.null</span>(rdata_dir)) {</span>
<span id="cb6-56"><a href="server.html#cb6-56" aria-hidden="true" tabindex="-1"></a>          ct <span class="ot">=</span> mat[[d]]</span>
<span id="cb6-57"><a href="server.html#cb6-57" aria-hidden="true" tabindex="-1"></a>          <span class="cf">if</span> (curr<span class="sc">$</span>Species <span class="sc">==</span> <span class="st">&quot;human&quot;</span>){</span>
<span id="cb6-58"><a href="server.html#cb6-58" aria-hidden="true" tabindex="-1"></a>            count_data <span class="ot">=</span> ct[ct<span class="sc">$</span>mgi_symbol <span class="sc">%in%</span> genes,]</span>
<span id="cb6-59"><a href="server.html#cb6-59" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb6-60"><a href="server.html#cb6-60" aria-hidden="true" tabindex="-1"></a>          <span class="cf">else</span> {</span>
<span id="cb6-61"><a href="server.html#cb6-61" aria-hidden="true" tabindex="-1"></a>            count_data <span class="ot">=</span> ct[ct<span class="sc">$</span>symbol <span class="sc">%in%</span> genes,]</span>
<span id="cb6-62"><a href="server.html#cb6-62" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb6-63"><a href="server.html#cb6-63" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb6-64"><a href="server.html#cb6-64" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-65"><a href="server.html#cb6-65" aria-hidden="true" tabindex="-1"></a>        <span class="co"># a list of filtered count data </span></span>
<span id="cb6-66"><a href="server.html#cb6-66" aria-hidden="true" tabindex="-1"></a>        df_list <span class="ot">=</span> <span class="fu">append</span>(df_list, <span class="fu">list</span>(count_data))</span>
<span id="cb6-67"><a href="server.html#cb6-67" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-68"><a href="server.html#cb6-68" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-69"><a href="server.html#cb6-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-70"><a href="server.html#cb6-70" aria-hidden="true" tabindex="-1"></a>      final_df <span class="ot">=</span> <span class="fu">generate_combine_dataset</span>(df_list, genes, input<span class="sc">$</span>sex, col_list[selected_data], des_df<span class="sc">$</span>condition[selected_data], des_df<span class="sc">$</span>Species[selected_data], </span>
<span id="cb6-71"><a href="server.html#cb6-71" aria-hidden="true" tabindex="-1"></a>                                          expression, Condition, Population, symbol, Dataset, Species)</span>
<span id="cb6-72"><a href="server.html#cb6-72" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-73"><a href="server.html#cb6-73" aria-hidden="true" tabindex="-1"></a>      <span class="co"># homepage dotplot</span></span>
<span id="cb6-74"><a href="server.html#cb6-74" aria-hidden="true" tabindex="-1"></a>      combine_dot <span class="ot">=</span> <span class="fu">plotcombine_server</span>(<span class="st">&quot;dot&quot;</span>, final_df, input<span class="sc">$</span>sex, genes, Population, symbol, expression, <span class="st">&quot;Dataset&quot;</span>) <span class="co">#dotplot</span></span>
<span id="cb6-75"><a href="server.html#cb6-75" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-76"><a href="server.html#cb6-76" aria-hidden="true" tabindex="-1"></a>      <span class="co"># deg plot</span></span>
<span id="cb6-77"><a href="server.html#cb6-77" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-78"><a href="server.html#cb6-78" aria-hidden="true" tabindex="-1"></a>      <span class="co"># first, convert gene symbols to species specific </span></span>
<span id="cb6-79"><a href="server.html#cb6-79" aria-hidden="true" tabindex="-1"></a>      hgenes <span class="ot">=</span> human_gene_data[human_gene_data<span class="sc">$</span>mgi_symbol <span class="sc">%in%</span> genes,]<span class="sc">$</span>hgnc_symbol</span>
<span id="cb6-80"><a href="server.html#cb6-80" aria-hidden="true" tabindex="-1"></a>      rgenes <span class="ot">=</span> rat_gene_data[rat_gene_data<span class="sc">$</span>mgi_symbol <span class="sc">%in%</span> genes,]<span class="sc">$</span>rgd_symbol</span>
<span id="cb6-81"><a href="server.html#cb6-81" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-82"><a href="server.html#cb6-82" aria-hidden="true" tabindex="-1"></a>      <span class="co"># filter differential expression data </span></span>
<span id="cb6-83"><a href="server.html#cb6-83" aria-hidden="true" tabindex="-1"></a>      degr <span class="ot">=</span> degrat[degrat<span class="sc">$</span>symbol <span class="sc">%in%</span> rgenes,]</span>
<span id="cb6-84"><a href="server.html#cb6-84" aria-hidden="true" tabindex="-1"></a>      degm <span class="ot">=</span> degmouse[degmouse<span class="sc">$</span>symbol <span class="sc">%in%</span> genes,]</span>
<span id="cb6-85"><a href="server.html#cb6-85" aria-hidden="true" tabindex="-1"></a>      degh <span class="ot">=</span> deghuman[deghuman<span class="sc">$</span>symbol <span class="sc">%in%</span> hgenes,]</span>
<span id="cb6-86"><a href="server.html#cb6-86" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-87"><a href="server.html#cb6-87" aria-hidden="true" tabindex="-1"></a>      combine_degplot <span class="ot">=</span> <span class="fu">deg_combine_server</span>(<span class="st">&quot;deg_plot&quot;</span>,degr, degm, degh, Population,symbol, log2FoldChange,sig, <span class="st">&quot;Dataset&quot;</span>)</span>
<span id="cb6-88"><a href="server.html#cb6-88" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-89"><a href="server.html#cb6-89" aria-hidden="true" tabindex="-1"></a>   </span>
<span id="cb6-90"><a href="server.html#cb6-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># give scRNA dot plots if data exists </span></span>
<span id="cb6-91"><a href="server.html#cb6-91" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(variables<span class="sc">$</span>pbmc) <span class="sc">!=</span> <span class="cn">TRUE</span>){</span>
<span id="cb6-92"><a href="server.html#cb6-92" aria-hidden="true" tabindex="-1"></a>      scrna_dot <span class="ot">=</span> <span class="fu">plothomescdot_server</span>(<span class="st">&quot;homespat&quot;</span>, variables<span class="sc">$</span>pbmc, genes)</span>
<span id="cb6-93"><a href="server.html#cb6-93" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb6-94"><a href="server.html#cb6-94" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-95"><a href="server.html#cb6-95" aria-hidden="true" tabindex="-1"></a>    <span class="co"># download all plots into a zip</span></span>
<span id="cb6-96"><a href="server.html#cb6-96" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>combineplots <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb6-97"><a href="server.html#cb6-97" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb6-98"><a href="server.html#cb6-98" aria-hidden="true" tabindex="-1"></a>        <span class="fu">paste</span>(<span class="st">&quot;combined&quot;</span>, <span class="st">&quot;zip&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb6-99"><a href="server.html#cb6-99" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb6-100"><a href="server.html#cb6-100" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-101"><a href="server.html#cb6-101" aria-hidden="true" tabindex="-1"></a>      <span class="at">content =</span> <span class="cf">function</span>(file){</span>
<span id="cb6-102"><a href="server.html#cb6-102" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Set temporary working directory</span></span>
<span id="cb6-103"><a href="server.html#cb6-103" aria-hidden="true" tabindex="-1"></a>        owd <span class="ot">&lt;-</span> <span class="fu">setwd</span>(<span class="fu">tempdir</span>())</span>
<span id="cb6-104"><a href="server.html#cb6-104" aria-hidden="true" tabindex="-1"></a>        <span class="fu">on.exit</span>(<span class="fu">setwd</span>(owd))</span>
<span id="cb6-105"><a href="server.html#cb6-105" aria-hidden="true" tabindex="-1"></a>        fs <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb6-106"><a href="server.html#cb6-106" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-107"><a href="server.html#cb6-107" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Save the plots</span></span>
<span id="cb6-108"><a href="server.html#cb6-108" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggsave</span>(<span class="st">&#39;combine_deg.png&#39;</span>, <span class="at">plot =</span> combine_degplot, <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb6-109"><a href="server.html#cb6-109" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggsave</span>(<span class="st">&#39;combine_dot.png&#39;</span>, <span class="at">plot =</span> combine_dot, <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb6-110"><a href="server.html#cb6-110" aria-hidden="true" tabindex="-1"></a>        <span class="fu">ggsave</span>(<span class="st">&#39;scrna_dot.png&#39;</span>, <span class="at">plot =</span> scrna_dot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb6-111"><a href="server.html#cb6-111" aria-hidden="true" tabindex="-1"></a>        fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;combine_deg.png&#39;</span>)</span>
<span id="cb6-112"><a href="server.html#cb6-112" aria-hidden="true" tabindex="-1"></a>        fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;combine_dot.png&#39;</span>)</span>
<span id="cb6-113"><a href="server.html#cb6-113" aria-hidden="true" tabindex="-1"></a>        fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;scrna_dot.png&#39;</span>)</span>
<span id="cb6-114"><a href="server.html#cb6-114" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-115"><a href="server.html#cb6-115" aria-hidden="true" tabindex="-1"></a>        <span class="co"># csv files for gene count data</span></span>
<span id="cb6-116"><a href="server.html#cb6-116" aria-hidden="true" tabindex="-1"></a>        <span class="fu">write.csv</span>(final_df,<span class="st">&quot;result_table.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb6-117"><a href="server.html#cb6-117" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-118"><a href="server.html#cb6-118" aria-hidden="true" tabindex="-1"></a>        fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&quot;result_table.csv&quot;</span>)</span>
<span id="cb6-119"><a href="server.html#cb6-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb6-120"><a href="server.html#cb6-120" aria-hidden="true" tabindex="-1"></a>        <span class="fu">zip</span>(file, fs)</span>
<span id="cb6-121"><a href="server.html#cb6-121" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb6-122"><a href="server.html#cb6-122" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-123"><a href="server.html#cb6-123" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-124"><a href="server.html#cb6-124" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
</div>
<div id="individual-analysis-1" class="section level3 hasAnchor" number="4.2.4">
<h3><span class="header-section-number">4.2.4</span> Individual Analysis<a href="server.html#individual-analysis-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><img src="data/Images/indiv.png" width="3453" /></p>
<p>First, a table that contains dataset description is rendered at the top.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="server.html#cb7-1" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>dataset_table <span class="ot">=</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb7-2"><a href="server.html#cb7-2" aria-hidden="true" tabindex="-1"></a>DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb7-3"><a href="server.html#cb7-3" aria-hidden="true" tabindex="-1"></a>  des_df[<span class="fu">c</span>(<span class="st">&quot;Dataset&quot;</span>, <span class="st">&quot;Pain_Model&quot;</span>, <span class="st">&quot;Species&quot;</span>, <span class="st">&quot;Tissue&quot;</span>)], <span class="do">## can select relevant columns</span></span>
<span id="cb7-4"><a href="server.html#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb7-5"><a href="server.html#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">class =</span> <span class="st">&#39;nowrap&#39;</span>,</span>
<span id="cb7-6"><a href="server.html#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">scrollY =</span> <span class="cn">TRUE</span>, <span class="at">pageLength =</span> <span class="dv">5</span>), <span class="at">selection =</span> <span class="st">&quot;single&quot;</span></span>
<span id="cb7-7"><a href="server.html#cb7-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb7-8"><a href="server.html#cb7-8" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>Next, the ui for each independent dataset is rendered in response to row selected from the table. This is passed by the <code>input$dataset_table_rows_selected</code> parameter and stored into a reactive variable indrows. The parameters required for calling the <code>shinypageUI</code> function is retrieved from the <code>des_df</code>.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="server.html#cb8-1" aria-hidden="true" tabindex="-1"></a>variables <span class="ot">=</span> <span class="fu">reactiveValues</span>({</span>
<span id="cb8-2"><a href="server.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  indrows <span class="ot">=</span> <span class="cn">NULL</span> </span>
<span id="cb8-3"><a href="server.html#cb8-3" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb8-4"><a href="server.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="server.html#cb8-5" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb8-6"><a href="server.html#cb8-6" aria-hidden="true" tabindex="-1"></a>    variables<span class="sc">$</span>indrows <span class="ot">=</span>input<span class="sc">$</span>dataset_table_rows_selected</span>
<span id="cb8-7"><a href="server.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  })</span>
<span id="cb8-8"><a href="server.html#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="server.html#cb8-9" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>shinypages  <span class="ot">=</span> shiny<span class="sc">::</span><span class="fu">renderUI</span>({</span>
<span id="cb8-10"><a href="server.html#cb8-10" aria-hidden="true" tabindex="-1"></a>    j <span class="ot">=</span> input<span class="sc">$</span>dataset_table_rows_selected</span>
<span id="cb8-11"><a href="server.html#cb8-11" aria-hidden="true" tabindex="-1"></a>    select <span class="ot">=</span> des_df[j,]</span>
<span id="cb8-12"><a href="server.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-13"><a href="server.html#cb8-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (select<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;single&quot;</span>){</span>
<span id="cb8-14"><a href="server.html#cb8-14" aria-hidden="true" tabindex="-1"></a>      <span class="fu">shinyscrnapageUI</span>(<span class="st">&quot;spatpage&quot;</span>, select<span class="sc">$</span>Dataset)</span>
<span id="cb8-15"><a href="server.html#cb8-15" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-16"><a href="server.html#cb8-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-17"><a href="server.html#cb8-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb8-18"><a href="server.html#cb8-18" aria-hidden="true" tabindex="-1"></a>      page_id <span class="ot">=</span> select<span class="sc">$</span>page_id</span>
<span id="cb8-19"><a href="server.html#cb8-19" aria-hidden="true" tabindex="-1"></a>      <span class="fu">shinypageUI</span>(page_id, select<span class="sc">$</span>Dataset,</span>
<span id="cb8-20"><a href="server.html#cb8-20" aria-hidden="true" tabindex="-1"></a>                  select<span class="sc">$</span>include_degs,</span>
<span id="cb8-21"><a href="server.html#cb8-21" aria-hidden="true" tabindex="-1"></a>                  select<span class="sc">$</span>include_subtypes, <span class="at">des_dir =</span> <span class="cn">NULL</span>)</span>
<span id="cb8-22"><a href="server.html#cb8-22" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-23"><a href="server.html#cb8-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-24"><a href="server.html#cb8-24" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
<p>The server functions for each study-specific ui called is shown below. The shinypage server module contains code for generating plots and result tables.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="server.html#cb9-1" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">observe</span>({</span>
<span id="cb9-2"><a href="server.html#cb9-2" aria-hidden="true" tabindex="-1"></a>    i <span class="ot">=</span> input<span class="sc">$</span>dataset_table_rows_selected</span>
<span id="cb9-3"><a href="server.html#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="server.html#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">is.null</span>(i) <span class="sc">==</span> <span class="cn">FALSE</span>) {</span>
<span id="cb9-5"><a href="server.html#cb9-5" aria-hidden="true" tabindex="-1"></a>      selected <span class="ot">=</span> des_df[i,]</span>
<span id="cb9-6"><a href="server.html#cb9-6" aria-hidden="true" tabindex="-1"></a>      page_id <span class="ot">=</span> selected<span class="sc">$</span>page_id</span>
<span id="cb9-7"><a href="server.html#cb9-7" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-8"><a href="server.html#cb9-8" aria-hidden="true" tabindex="-1"></a>      <span class="co"># bulk rnaseq </span></span>
<span id="cb9-9"><a href="server.html#cb9-9" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (selected<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;bulk&quot;</span>) {</span>
<span id="cb9-10"><a href="server.html#cb9-10" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">callModule</span>(shinypage, page_id, input<span class="sc">$</span>sex, selected<span class="sc">$</span>count, <span class="fu">as.data.frame</span>(col_list[i]),</span>
<span id="cb9-11"><a href="server.html#cb9-11" aria-hidden="true" tabindex="-1"></a>                          selected<span class="sc">$</span>Species, selected<span class="sc">$</span>condition, <span class="fu">reactive</span>({<span class="fu">genes</span>()}), <span class="at">deg_df_name =</span> selected<span class="sc">$</span>deg_df_name,</span>
<span id="cb9-12"><a href="server.html#cb9-12" aria-hidden="true" tabindex="-1"></a>                          <span class="at">dataset =</span> selected<span class="sc">$</span>Dataset, <span class="at">parent =</span> session)</span>
<span id="cb9-13"><a href="server.html#cb9-13" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-14"><a href="server.html#cb9-14" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb9-15"><a href="server.html#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="co"># single rnaseq</span></span>
<span id="cb9-16"><a href="server.html#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (selected<span class="sc">$</span>type <span class="sc">==</span> <span class="st">&quot;single&quot;</span>){</span>
<span id="cb9-17"><a href="server.html#cb9-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-18"><a href="server.html#cb9-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> (<span class="fu">is.null</span>(variables<span class="sc">$</span>pbmc[[selected<span class="sc">$</span>Dataset]]) <span class="sc">==</span> <span class="cn">TRUE</span>) {</span>
<span id="cb9-19"><a href="server.html#cb9-19" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb9-20"><a href="server.html#cb9-20" aria-hidden="true" tabindex="-1"></a>          <span class="co"># make sure that scRNA data is already read into reactive variables</span></span>
<span id="cb9-21"><a href="server.html#cb9-21" aria-hidden="true" tabindex="-1"></a>          <span class="cf">for</span> (c <span class="cf">in</span> scRNA_dir) {</span>
<span id="cb9-22"><a href="server.html#cb9-22" aria-hidden="true" tabindex="-1"></a>            variables<span class="sc">$</span>pbmc <span class="ot">&lt;-</span> <span class="fu">c</span>(variables<span class="sc">$</span>pbmc, <span class="fu">readRDS</span>(scRNA_dir[[<span class="dv">1</span>]]))</span>
<span id="cb9-23"><a href="server.html#cb9-23" aria-hidden="true" tabindex="-1"></a>          }</span>
<span id="cb9-24"><a href="server.html#cb9-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">names</span>(variables<span class="sc">$</span>pbmc) <span class="ot">=</span> scRNA_names</span>
<span id="cb9-25"><a href="server.html#cb9-25" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb9-26"><a href="server.html#cb9-26" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-27"><a href="server.html#cb9-27" aria-hidden="true" tabindex="-1"></a>        shiny<span class="sc">::</span><span class="fu">callModule</span>(shinyscrna, <span class="st">&quot;spatpage&quot;</span>, <span class="fu">reactive</span>({<span class="fu">genes</span>()}), variables<span class="sc">$</span>pbmc[[selected<span class="sc">$</span>Dataset]])</span>
<span id="cb9-28"><a href="server.html#cb9-28" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb9-29"><a href="server.html#cb9-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-30"><a href="server.html#cb9-30" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb9-31"><a href="server.html#cb9-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-32"><a href="server.html#cb9-32" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
</div>
</div>
<div id="network-analysis" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> Network Analysis<a href="server.html#network-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Network integration can give context when working with large datasets, and provide a platform to integrate information from multiple sources.</p>
<p><img src="data/Images/network.png" width="3312" /></p>
<p>Here, networks are built using protein–protein interaction data taken from the STRING database. The network can be enriched in various ways. As an example, we have enriched the STRING networks in our example by:</p>
<ol style="list-style-type: decimal">
<li>An <em>Enrichment Score</em>, an integrated statistic using data from all experiments.</li>
<li>Differential expression in an individual experiment.</li>
<li>Genes of interest, as a list</li>
</ol>
<ul>
<li>Here, we used known pain-associated genes from various sources</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="server.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># update choice</span></span>
<span id="cb10-2"><a href="server.html#cb10-2" aria-hidden="true" tabindex="-1"></a>shiny<span class="sc">::</span><span class="fu">updateSelectizeInput</span>(session,</span>
<span id="cb10-3"><a href="server.html#cb10-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">inputId =</span> <span class="st">&quot;gene_symbols&quot;</span>,</span>
<span id="cb10-4"><a href="server.html#cb10-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">label =</span> <span class="st">&quot;Search Genes:&quot;</span>,</span>
<span id="cb10-5"><a href="server.html#cb10-5" aria-hidden="true" tabindex="-1"></a>                            <span class="at">choices =</span> human_gene_data<span class="sc">$</span>hgnc_symbol,</span>
<span id="cb10-6"><a href="server.html#cb10-6" aria-hidden="true" tabindex="-1"></a>                            <span class="at">server =</span> <span class="cn">TRUE</span>,</span>
<span id="cb10-7"><a href="server.html#cb10-7" aria-hidden="true" tabindex="-1"></a>                            <span class="at">selected =</span> <span class="fu">c</span>(<span class="st">&quot;ATF3&quot;</span>) <span class="do">## choose your favourite</span></span>
<span id="cb10-8"><a href="server.html#cb10-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<div id="integration-with-string-db" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Integration with STRING DB<a href="server.html#integration-with-string-db" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Node and edge data is extracted in real-time from STRING <a href="https://string-db.org/" class="uri">https://string-db.org/</a> and reconstructed into a network based on user input.</p>
<p><em>For reference only, you don’t need to modify this.</em></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="server.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="do">### this doesn&#39;t need to be modified</span></span>
<span id="cb11-2"><a href="server.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># generates network  when the submit button is clicked </span></span>
<span id="cb11-3"><a href="server.html#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">observeEvent</span>(input<span class="sc">$</span>submit, {</span>
<span id="cb11-4"><a href="server.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Query gene interactions</span></span>
<span id="cb11-5"><a href="server.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    genes_list <span class="ot">=</span> <span class="fu">as.vector</span>(input<span class="sc">$</span>gene_symbols)</span>
<span id="cb11-6"><a href="server.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    genes <span class="ot">=</span> <span class="fu">paste</span>(genes_list, <span class="at">collapse =</span> <span class="st">&quot;%0d&quot;</span>)</span>
<span id="cb11-7"><a href="server.html#cb11-7" aria-hidden="true" tabindex="-1"></a>    interactions <span class="ot">&lt;-</span> <span class="fu">query_interactions</span>(genes, <span class="dv">10</span>)</span>
<span id="cb11-8"><a href="server.html#cb11-8" aria-hidden="true" tabindex="-1"></a>    proteins <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">unique</span>(interactions<span class="sc">$</span>preferredName_A), <span class="fu">unique</span>(interactions<span class="sc">$</span>preferredName_B)))</span>
<span id="cb11-9"><a href="server.html#cb11-9" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">=</span> <span class="fu">data.frame</span>()</span>
<span id="cb11-10"><a href="server.html#cb11-10" aria-hidden="true" tabindex="-1"></a>    id <span class="ot">=</span> <span class="fu">unique</span>(<span class="fu">c</span>(<span class="fu">unique</span>(interactions<span class="sc">$</span>stringId_A), <span class="fu">unique</span>(interactions<span class="sc">$</span>stringId_B)))</span>
<span id="cb11-11"><a href="server.html#cb11-11" aria-hidden="true" tabindex="-1"></a>    nodes<span class="ot">=</span> <span class="fu">as.data.frame</span>(id)</span>
<span id="cb11-12"><a href="server.html#cb11-12" aria-hidden="true" tabindex="-1"></a>    nodes<span class="sc">$</span>label <span class="ot">=</span> proteins</span>
<span id="cb11-13"><a href="server.html#cb11-13" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">=</span> <span class="fu">mutate</span>(nodes, <span class="at">shape =</span> <span class="fu">ifelse</span>(nodes<span class="sc">$</span>label <span class="sc">%in%</span> input<span class="sc">$</span>gene_symbols, <span class="st">&quot;diamond&quot;</span>, <span class="st">&quot;circle&quot;</span>))</span>
<span id="cb11-14"><a href="server.html#cb11-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-15"><a href="server.html#cb11-15" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-16"><a href="server.html#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (input<span class="sc">$</span>pop <span class="sc">==</span> <span class="st">&quot;Composite Enrichment Score&quot;</span>) {</span>
<span id="cb11-17"><a href="server.html#cb11-17" aria-hidden="true" tabindex="-1"></a>      mode <span class="ot">=</span> <span class="st">&quot;meta&quot;</span></span>
<span id="cb11-18"><a href="server.html#cb11-18" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">=</span> score_df</span>
<span id="cb11-19"><a href="server.html#cb11-19" aria-hidden="true" tabindex="-1"></a>      dt <span class="ot">=</span> score_df[score_df<span class="sc">$</span>symbol <span class="sc">%in%</span> proteins,]</span>
<span id="cb11-20"><a href="server.html#cb11-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-21"><a href="server.html#cb11-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span> {</span>
<span id="cb11-22"><a href="server.html#cb11-22" aria-hidden="true" tabindex="-1"></a>      mode <span class="ot">=</span> <span class="st">&quot;indiv&quot;</span></span>
<span id="cb11-23"><a href="server.html#cb11-23" aria-hidden="true" tabindex="-1"></a>      <span class="co"># the dict contains deg_df based on the name of datasets</span></span>
<span id="cb11-24"><a href="server.html#cb11-24" aria-hidden="true" tabindex="-1"></a>      <span class="co"># res = network_df[network_df$experiment_id == input$pop,]</span></span>
<span id="cb11-25"><a href="server.html#cb11-25" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">=</span> degall[degall<span class="sc">$</span>Dataset <span class="sc">==</span> input<span class="sc">$</span>pop,]</span>
<span id="cb11-26"><a href="server.html#cb11-26" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">=</span> <span class="fu">subset</span>(res, <span class="sc">!</span><span class="fu">duplicated</span>(symbol))</span>
<span id="cb11-27"><a href="server.html#cb11-27" aria-hidden="true" tabindex="-1"></a>      res <span class="ot">=</span> <span class="fu">mutate</span>(res, <span class="at">sig=</span><span class="fu">ifelse</span>((res<span class="sc">$</span>padj<span class="sc">&lt;</span><span class="fl">0.05</span>), <span class="st">&quot;SIG&quot;</span>, <span class="st">&quot;NS&quot;</span>))</span>
<span id="cb11-28"><a href="server.html#cb11-28" aria-hidden="true" tabindex="-1"></a>      metrics <span class="ot">=</span> res</span>
<span id="cb11-29"><a href="server.html#cb11-29" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-30"><a href="server.html#cb11-30" aria-hidden="true" tabindex="-1"></a>      <span class="co"># account for species differences </span></span>
<span id="cb11-31"><a href="server.html#cb11-31" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-32"><a href="server.html#cb11-32" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">unique</span>(res<span class="sc">$</span>Species) <span class="sc">==</span> <span class="st">&quot;mouse&quot;</span>) {</span>
<span id="cb11-33"><a href="server.html#cb11-33" aria-hidden="true" tabindex="-1"></a>        proteins <span class="ot">=</span> human_gene_data[human_gene_data<span class="sc">$</span>hgnc_symbol <span class="sc">%in%</span> proteins,]<span class="sc">$</span>mgi_symbol</span>
<span id="cb11-34"><a href="server.html#cb11-34" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-35"><a href="server.html#cb11-35" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span> (<span class="fu">unique</span>(res<span class="sc">$</span>Species) <span class="sc">==</span> <span class="st">&quot;rat&quot;</span>) {</span>
<span id="cb11-36"><a href="server.html#cb11-36" aria-hidden="true" tabindex="-1"></a>        proteins <span class="ot">=</span> human_gene_data[human_gene_data<span class="sc">$</span>hgnc_symbol <span class="sc">%in%</span> proteins,]<span class="sc">$</span>mgi_symbol</span>
<span id="cb11-37"><a href="server.html#cb11-37" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-38"><a href="server.html#cb11-38" aria-hidden="true" tabindex="-1"></a>      dt <span class="ot">=</span> <span class="fu">filter</span>(res, symbol <span class="sc">%in%</span> proteins)  <span class="co"># this means the proteins must be in human symbol</span></span>
<span id="cb11-39"><a href="server.html#cb11-39" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-40"><a href="server.html#cb11-40" aria-hidden="true" tabindex="-1"></a>      <span class="co"># remove duplicate </span></span>
<span id="cb11-41"><a href="server.html#cb11-41" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb11-42"><a href="server.html#cb11-42" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rownames</span>(dt) <span class="ot">=</span> dt<span class="sc">$</span>symbol</span>
<span id="cb11-43"><a href="server.html#cb11-43" aria-hidden="true" tabindex="-1"></a>      dt <span class="ot">=</span> dt[<span class="fu">c</span>(<span class="st">&quot;log2FoldChange&quot;</span>,<span class="st">&quot;padj&quot;</span>, <span class="st">&quot;sig&quot;</span>)]</span>
<span id="cb11-44"><a href="server.html#cb11-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-45"><a href="server.html#cb11-45" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb11-46"><a href="server.html#cb11-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-47"><a href="server.html#cb11-47" aria-hidden="true" tabindex="-1"></a>    <span class="co"># network construction</span></span>
<span id="cb11-48"><a href="server.html#cb11-48" aria-hidden="true" tabindex="-1"></a>    nodes <span class="ot">=</span> <span class="fu">get_nodes</span>(interactions, genes_list, metrics, <span class="at">mode=</span>mode, snps, pg1, pg2)</span>
<span id="cb11-49"><a href="server.html#cb11-49" aria-hidden="true" tabindex="-1"></a>    edges <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">from =</span> interactions<span class="sc">$</span>stringId_A, <span class="at">to =</span> interactions<span class="sc">$</span>stringId_B, <span class="at">width =</span> interactions<span class="sc">$</span>score,</span>
<span id="cb11-50"><a href="server.html#cb11-50" aria-hidden="true" tabindex="-1"></a>                        <span class="at">color =</span> <span class="st">&quot;#444444&quot;</span>)</span>
<span id="cb11-51"><a href="server.html#cb11-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-52"><a href="server.html#cb11-52" aria-hidden="true" tabindex="-1"></a>    lnodes <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">shape =</span> <span class="fu">c</span>( <span class="st">&quot;icon&quot;</span>), </span>
<span id="cb11-53"><a href="server.html#cb11-53" aria-hidden="true" tabindex="-1"></a>                         <span class="at">icon.color =</span> <span class="fu">c</span>(<span class="st">&quot;#961252&quot;</span>, <span class="st">&quot;#d8aec4ff&quot;</span>, <span class="st">&quot;lightgrey&quot;</span>, <span class="st">&quot;#aed5eaff&quot;</span>,<span class="st">&quot;#0277bd&quot;</span>),</span>
<span id="cb11-54"><a href="server.html#cb11-54" aria-hidden="true" tabindex="-1"></a>                         <span class="at">icon.code  =</span> <span class="fu">c</span>(<span class="st">&quot;f35b&quot;</span>, <span class="st">&quot;f111&quot;</span>, <span class="st">&quot;f111&quot;</span>, <span class="st">&quot;f111&quot;</span>, <span class="st">&quot;f358&quot;</span>),</span>
<span id="cb11-55"><a href="server.html#cb11-55" aria-hidden="true" tabindex="-1"></a>                         <span class="at">icon.size =</span> <span class="dv">30</span>) </span>
<span id="cb11-56"><a href="server.html#cb11-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-57"><a href="server.html#cb11-57" aria-hidden="true" tabindex="-1"></a>    <span class="co"># network visualisation</span></span>
<span id="cb11-58"><a href="server.html#cb11-58" aria-hidden="true" tabindex="-1"></a>    nw <span class="ot">=</span> visNetwork<span class="sc">::</span><span class="fu">visNetwork</span>(nodes, edges, <span class="at">height =</span> <span class="st">&quot;500px&quot;</span>, <span class="at">width =</span> <span class="st">&quot;100%&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-59"><a href="server.html#cb11-59" aria-hidden="true" tabindex="-1"></a>      <span class="fu">visPhysics</span>(<span class="at">enabled =</span> <span class="cn">FALSE</span>,<span class="at">solver =</span> <span class="st">&quot;forceAtlas2Based&quot;</span>,</span>
<span id="cb11-60"><a href="server.html#cb11-60" aria-hidden="true" tabindex="-1"></a>                 <span class="at">forceAtlas2Based =</span> <span class="fu">list</span>(<span class="at">avoidOverlap =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-61"><a href="server.html#cb11-61" aria-hidden="true" tabindex="-1"></a>      <span class="fu">visEdges</span>(<span class="at">smooth =</span> <span class="cn">FALSE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-62"><a href="server.html#cb11-62" aria-hidden="true" tabindex="-1"></a>      <span class="fu">visInteraction</span>(<span class="at">navigationButtons =</span> <span class="cn">TRUE</span>, <span class="at">zoomSpeed =</span> <span class="fl">0.6</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-63"><a href="server.html#cb11-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">visLegend</span>(<span class="at">addNodes =</span> lnodes, </span>
<span id="cb11-64"><a href="server.html#cb11-64" aria-hidden="true" tabindex="-1"></a>                <span class="co">#main = list(text = &quot;Enrichment&quot;, style = &quot;font-family:Gadugi&quot;),</span></span>
<span id="cb11-65"><a href="server.html#cb11-65" aria-hidden="true" tabindex="-1"></a>                <span class="at">useGroups =</span> <span class="cn">FALSE</span>, </span>
<span id="cb11-66"><a href="server.html#cb11-66" aria-hidden="true" tabindex="-1"></a>                <span class="at">width =</span> <span class="fl">0.2</span>, </span>
<span id="cb11-67"><a href="server.html#cb11-67" aria-hidden="true" tabindex="-1"></a>                <span class="at">position =</span> <span class="st">&quot;right&quot;</span>,</span>
<span id="cb11-68"><a href="server.html#cb11-68" aria-hidden="true" tabindex="-1"></a>                <span class="at">ncol =</span> <span class="dv">1</span>,</span>
<span id="cb11-69"><a href="server.html#cb11-69" aria-hidden="true" tabindex="-1"></a>                <span class="at">stepY =</span> <span class="dv">50</span>,</span>
<span id="cb11-70"><a href="server.html#cb11-70" aria-hidden="true" tabindex="-1"></a>                <span class="co">#stepX = 50,</span></span>
<span id="cb11-71"><a href="server.html#cb11-71" aria-hidden="true" tabindex="-1"></a>                <span class="at">zoom =</span> <span class="cn">FALSE</span>)</span>
<span id="cb11-72"><a href="server.html#cb11-72" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>network <span class="ot">&lt;-</span> <span class="fu">renderVisNetwork</span>({nw})</span>
<span id="cb11-73"><a href="server.html#cb11-73" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-74"><a href="server.html#cb11-74" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>downloadnet <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb11-75"><a href="server.html#cb11-75" aria-hidden="true" tabindex="-1"></a>      <span class="at">filename =</span> <span class="st">&quot;graph.html&quot;</span>,</span>
<span id="cb11-76"><a href="server.html#cb11-76" aria-hidden="true" tabindex="-1"></a>      <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb11-77"><a href="server.html#cb11-77" aria-hidden="true" tabindex="-1"></a>        <span class="fu">visSave</span>(nw, file)</span>
<span id="cb11-78"><a href="server.html#cb11-78" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb11-79"><a href="server.html#cb11-79" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb11-80"><a href="server.html#cb11-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-81"><a href="server.html#cb11-81" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>contrast_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb11-82"><a href="server.html#cb11-82" aria-hidden="true" tabindex="-1"></a>      DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb11-83"><a href="server.html#cb11-83" aria-hidden="true" tabindex="-1"></a>        dt,</span>
<span id="cb11-84"><a href="server.html#cb11-84" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb11-85"><a href="server.html#cb11-85" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">&#39;nowrap&#39;</span>,</span>
<span id="cb11-86"><a href="server.html#cb11-86" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">pageLength =</span> <span class="dv">8</span>)</span>
<span id="cb11-87"><a href="server.html#cb11-87" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-88"><a href="server.html#cb11-88" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-89"><a href="server.html#cb11-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-90"><a href="server.html#cb11-90" aria-hidden="true" tabindex="-1"></a>    <span class="co"># a table containing description and information of genes included</span></span>
<span id="cb11-91"><a href="server.html#cb11-91" aria-hidden="true" tabindex="-1"></a>    output<span class="sc">$</span>protein_table <span class="ot">&lt;-</span> DT<span class="sc">::</span><span class="fu">renderDataTable</span>({</span>
<span id="cb11-92"><a href="server.html#cb11-92" aria-hidden="true" tabindex="-1"></a>      DT<span class="sc">::</span><span class="fu">datatable</span>(</span>
<span id="cb11-93"><a href="server.html#cb11-93" aria-hidden="true" tabindex="-1"></a>        <span class="fu">query_information</span>(proteins),</span>
<span id="cb11-94"><a href="server.html#cb11-94" aria-hidden="true" tabindex="-1"></a>        <span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb11-95"><a href="server.html#cb11-95" aria-hidden="true" tabindex="-1"></a>        <span class="at">class =</span> <span class="st">&quot;wrap&quot;</span>,</span>
<span id="cb11-96"><a href="server.html#cb11-96" aria-hidden="true" tabindex="-1"></a>        <span class="at">options =</span> <span class="fu">list</span>(<span class="at">scrollX =</span> <span class="cn">TRUE</span>, <span class="at">pageLength =</span> <span class="dv">8</span>)</span>
<span id="cb11-97"><a href="server.html#cb11-97" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb11-98"><a href="server.html#cb11-98" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb11-99"><a href="server.html#cb11-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb11-100"><a href="server.html#cb11-100" aria-hidden="true" tabindex="-1"></a>  })</span></code></pre></div>
</div>
</div>
<div id="functions" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> Functions<a href="server.html#functions" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><em>An run-down of functions used throughout the app. For basic applications these don’t need to be modified.</em> A function can be called and reused multiple times by passing parameters. For this example database, functions are written for rendering plots. To illustrate them, we will use an example count dataset.</p>
<div id="data-processing" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Data processing<a href="server.html#data-processing" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="server.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; a function that gets the median expression of a count data </span></span>
<span id="cb12-2"><a href="server.html#cb12-2" aria-hidden="true" tabindex="-1"></a>get_median <span class="ot">&lt;-</span> <span class="cf">function</span>(df, sex, var, ...){</span>
<span id="cb12-3"><a href="server.html#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ifelse</span>(sex<span class="sc">==</span><span class="st">&quot;Both&quot;</span>, data <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(...) <span class="sc">%&gt;%</span></span>
<span id="cb12-4"><a href="server.html#cb12-4" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">expression=</span><span class="fu">median</span>(<span class="fu">as.double</span>({{var}}))), df <span class="ot">&lt;-</span> tcounts <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">group_by</span>(..., Sex) <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="server.html#cb12-5" aria-hidden="true" tabindex="-1"></a>           dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">expression=</span><span class="fu">median</span>(<span class="fu">as.double</span>({{var}}))))</span>
<span id="cb12-6"><a href="server.html#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb12-7"><a href="server.html#cb12-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="server.html#cb13-1" aria-hidden="true" tabindex="-1"></a>genes <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;Atf3&quot;</span>, <span class="st">&quot;Msh6&quot;</span>, <span class="st">&quot;Dlst&quot;</span>, <span class="st">&quot;Slc2a9&quot;</span>)</span>
<span id="cb13-2"><a href="server.html#cb13-2" aria-hidden="true" tabindex="-1"></a>sex <span class="ot">=</span> <span class="st">&quot;Both&quot;</span></span>
<span id="cb13-3"><a href="server.html#cb13-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-4"><a href="server.html#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co"># load data</span></span>
<span id="cb13-5"><a href="server.html#cb13-5" aria-hidden="true" tabindex="-1"></a>count   <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="st">&quot;./data/CountTables/TPM_mouse.csv&quot;</span>, <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-6"><a href="server.html#cb13-6" aria-hidden="true" tabindex="-1"></a>colData <span class="ot">=</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;./data/colData/&quot;</span>, <span class="st">&quot;TPM_mouse_colData.csv&quot;</span>), <span class="at">header =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-7"><a href="server.html#cb13-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(colData) <span class="ot">=</span> colData<span class="sc">$</span>X</span>
<span id="cb13-8"><a href="server.html#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="server.html#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="co"># filter data</span></span>
<span id="cb13-10"><a href="server.html#cb13-10" aria-hidden="true" tabindex="-1"></a>filt <span class="ot">=</span> count[count<span class="sc">$</span>symbol <span class="sc">%in%</span> genes,]</span>
<span id="cb13-11"><a href="server.html#cb13-11" aria-hidden="true" tabindex="-1"></a>matfilt <span class="ot">=</span> filt[,<span class="sc">!</span>(<span class="fu">names</span>(filt) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;symbol&quot;</span>))] </span>
<span id="cb13-12"><a href="server.html#cb13-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-13"><a href="server.html#cb13-13" aria-hidden="true" tabindex="-1"></a><span class="co"># rename the first column </span></span>
<span id="cb13-14"><a href="server.html#cb13-14" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(matfilt) <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&quot;gene&quot;</span>, <span class="fu">colnames</span>(matfilt)[<span class="dv">2</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">colnames</span>(matfilt))])</span>
<span id="cb13-15"><a href="server.html#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(matfilt) <span class="ot">=</span> matfilt<span class="sc">$</span>gene</span>
<span id="cb13-16"><a href="server.html#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="server.html#cb13-17" aria-hidden="true" tabindex="-1"></a><span class="co"># group based on experimental conditions </span></span>
<span id="cb13-18"><a href="server.html#cb13-18" aria-hidden="true" tabindex="-1"></a>tcounts <span class="ot">&lt;-</span> <span class="fu">t</span>(matfilt) <span class="sc">%&gt;%</span></span>
<span id="cb13-19"><a href="server.html#cb13-19" aria-hidden="true" tabindex="-1"></a>  base<span class="sc">::</span><span class="fu">merge</span>(colData, ., <span class="at">by=</span><span class="st">&quot;row.names&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb13-20"><a href="server.html#cb13-20" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">gather</span>(gene, expression, (<span class="fu">ncol</span>(.)<span class="sc">-</span><span class="fu">nrow</span>(matfilt)<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="fu">ncol</span>(.)))</span>
<span id="cb13-21"><a href="server.html#cb13-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-22"><a href="server.html#cb13-22" aria-hidden="true" tabindex="-1"></a>tcounts<span class="sc">$</span>symbol <span class="ot">=</span> filt[filt<span class="sc">$</span>X <span class="sc">%in%</span> tcounts<span class="sc">$</span>gene,]<span class="sc">$</span>symbol</span>
<span id="cb13-23"><a href="server.html#cb13-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-24"><a href="server.html#cb13-24" aria-hidden="true" tabindex="-1"></a><span class="co"># get median expression</span></span>
<span id="cb13-25"><a href="server.html#cb13-25" aria-hidden="true" tabindex="-1"></a>tcounts_med <span class="ot">=</span> <span class="fu">get_median</span>(tcounts, sex, expression, Condition, Population, symbol, Dataset, Species)</span>
<span id="cb13-26"><a href="server.html#cb13-26" aria-hidden="true" tabindex="-1"></a>tcounts_med <span class="ot">&lt;-</span> tcounts_med[<span class="sc">!</span>tcounts_med<span class="sc">$</span>Condition <span class="sc">%in%</span> <span class="st">&quot;SNI&quot;</span>, ] <span class="co"># remove pain samples</span></span></code></pre></div>
</div>
<div id="dot-plots" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Dot plots<a href="server.html#dot-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>median counts <em>(here, transcripts per million (TPM))</em></li>
</ul>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="server.html#cb14-1" aria-hidden="true" tabindex="-1"></a>plot_dotplot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var, col_var, facet_var, sex){</span>
<span id="cb14-2"><a href="server.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  x_var <span class="ot">=</span> <span class="fu">enquo</span>(x_var)</span>
<span id="cb14-3"><a href="server.html#cb14-3" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">=</span> <span class="fu">enquo</span>(y_var)</span>
<span id="cb14-4"><a href="server.html#cb14-4" aria-hidden="true" tabindex="-1"></a>  col_var <span class="ot">=</span> <span class="fu">enquo</span>(col_var)</span>
<span id="cb14-5"><a href="server.html#cb14-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-6"><a href="server.html#cb14-6" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span>x_var, <span class="at">y =</span> <span class="sc">!!</span>y_var)) <span class="sc">+</span></span>
<span id="cb14-7"><a href="server.html#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;magma&quot;</span>, <span class="at">end =</span> .<span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="server.html#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="fu">log</span>(<span class="sc">!!</span>col_var), <span class="at">size=</span><span class="fu">log</span>(<span class="sc">!!</span>col_var))) <span class="sc">+</span> </span>
<span id="cb14-9"><a href="server.html#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_grid</span>(.<span class="sc">~</span>.data[[facet_var]], <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">space=</span><span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-10"><a href="server.html#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span>population_labels) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">col=</span><span class="st">&quot;log(TPM)&quot;</span>, <span class="at">size =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-11"><a href="server.html#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb14-12"><a href="server.html#cb14-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-13"><a href="server.html#cb14-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># add themes </span></span>
<span id="cb14-14"><a href="server.html#cb14-14" aria-hidden="true" tabindex="-1"></a>  g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-15"><a href="server.html#cb14-15" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-16"><a href="server.html#cb14-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span> <span class="dv">1</span>),</span>
<span id="cb14-17"><a href="server.html#cb14-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb14-18"><a href="server.html#cb14-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-19"><a href="server.html#cb14-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb14-20"><a href="server.html#cb14-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">2</span>)), </span>
<span id="cb14-21"><a href="server.html#cb14-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;mm&quot;</span>)) </span>
<span id="cb14-22"><a href="server.html#cb14-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-23"><a href="server.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-24"><a href="server.html#cb14-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sex <span class="sc">==</span> <span class="st">&quot;Separate&quot;</span>) {</span>
<span id="cb14-25"><a href="server.html#cb14-25" aria-hidden="true" tabindex="-1"></a>    g <span class="ot">=</span> g <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sex, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Sex =</span> sexlabels), <span class="at">scales =</span><span class="st">&quot;free_x&quot;</span>)</span>
<span id="cb14-26"><a href="server.html#cb14-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-27"><a href="server.html#cb14-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(g)</span>
<span id="cb14-28"><a href="server.html#cb14-28" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb14-29"><a href="server.html#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="server.html#cb14-30" aria-hidden="true" tabindex="-1"></a>dotplot <span class="ot">=</span> <span class="fu">plot_dotplot</span>(tcounts_med, Population, symbol, expression, <span class="st">&quot;Dataset&quot;</span>, sex)</span>
<span id="cb14-31"><a href="server.html#cb14-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dotplot)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
</div>
<div id="line-plots" class="section level3 hasAnchor" number="4.4.3">
<h3><span class="header-section-number">4.4.3</span> Line plots<a href="server.html#line-plots" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Median gene expression in case and control conditions</li>
<li>Linetype is encoded by the timepoint of treatment group (if exists)</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="server.html#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param group_vars symbol, Timepoint</span></span>
<span id="cb15-2"><a href="server.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39; @param linetype_var Timepoint</span></span>
<span id="cb15-3"><a href="server.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&#39;</span></span>
<span id="cb15-4"><a href="server.html#cb15-4" aria-hidden="true" tabindex="-1"></a>plot_lineplot <span class="ot">&lt;-</span> <span class="cf">function</span>(data,sex, x_var, y_var, col_var, linetype_var, ...){</span>
<span id="cb15-5"><a href="server.html#cb15-5" aria-hidden="true" tabindex="-1"></a>  x_var <span class="ot">=</span> <span class="fu">enquo</span>(x_var)</span>
<span id="cb15-6"><a href="server.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">=</span> <span class="fu">enquo</span>(y_var)</span>
<span id="cb15-7"><a href="server.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  col_var <span class="ot">=</span> <span class="fu">enquo</span>(col_var)</span>
<span id="cb15-8"><a href="server.html#cb15-8" aria-hidden="true" tabindex="-1"></a>  group_vars <span class="ot">=</span> <span class="fu">enquos</span>(...)</span>
<span id="cb15-9"><a href="server.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  linetype_var <span class="ot">=</span> <span class="fu">enquo</span>(linetype_var)</span>
<span id="cb15-10"><a href="server.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-11"><a href="server.html#cb15-11" aria-hidden="true" tabindex="-1"></a>  theme_line <span class="ot">=</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> </span>
<span id="cb15-12"><a href="server.html#cb15-12" aria-hidden="true" tabindex="-1"></a>                <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-13"><a href="server.html#cb15-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>),</span>
<span id="cb15-14"><a href="server.html#cb15-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span> <span class="dv">1</span>),</span>
<span id="cb15-15"><a href="server.html#cb15-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb15-16"><a href="server.html#cb15-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-17"><a href="server.html#cb15-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>))</span>
<span id="cb15-18"><a href="server.html#cb15-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-19"><a href="server.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-20"><a href="server.html#cb15-20" aria-hidden="true" tabindex="-1"></a>  lineplot <span class="ot">=</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span><span class="sc">!!</span>x_var, <span class="at">y=</span><span class="sc">!!</span>y_var, <span class="at">group=</span><span class="fu">interaction</span>(<span class="sc">!!!</span>group_vars))) <span class="sc">+</span></span>
<span id="cb15-21"><a href="server.html#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_viridis</span>(<span class="at">discrete=</span><span class="cn">TRUE</span>, <span class="at">end =</span> .<span class="dv">80</span>) <span class="sc">+</span></span>
<span id="cb15-22"><a href="server.html#cb15-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">color=</span><span class="sc">!!</span>col_var, <span class="at">linetype=</span><span class="sc">!!</span>linetype_var)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="sc">!!</span>col_var)) <span class="sc">+</span> theme_line <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Expression&quot;</span>) <span class="sc">+</span></span>
<span id="cb15-23"><a href="server.html#cb15-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">linetype=</span><span class="fu">guide_legend</span>(<span class="at">label.hjust=</span><span class="fl">0.5</span>))</span>
<span id="cb15-24"><a href="server.html#cb15-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (sex <span class="sc">==</span><span class="st">&#39;Separate&#39;</span>){</span>
<span id="cb15-25"><a href="server.html#cb15-25" aria-hidden="true" tabindex="-1"></a>    lineplot <span class="ot">=</span> lineplot <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>Sex, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Sex =</span> sexlabels), <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>) <span class="sc">+</span> <span class="fu">labs</span>(<span class="at">col=</span><span class="st">&quot;&quot;</span>)</span>
<span id="cb15-26"><a href="server.html#cb15-26" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-27"><a href="server.html#cb15-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-28"><a href="server.html#cb15-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lineplot)</span>
<span id="cb15-29"><a href="server.html#cb15-29" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-30"><a href="server.html#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="server.html#cb15-31" aria-hidden="true" tabindex="-1"></a>tcounts_m <span class="ot">=</span> <span class="fu">get_median</span>(tcounts, sex, <span class="at">var =</span> expression, Condition, symbol, Timepoint, Dataset, Species)</span>
<span id="cb15-32"><a href="server.html#cb15-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-33"><a href="server.html#cb15-33" aria-hidden="true" tabindex="-1"></a>lineplot <span class="ot">=</span> <span class="fu">plot_lineplot</span>(tcounts_m, sex, Condition, expression, symbol, Timepoint, symbol, Timepoint)</span>
<span id="cb15-34"><a href="server.html#cb15-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lineplot) </span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
</div>
<div id="a-differential-expression-dot-plot" class="section level3 hasAnchor" number="4.4.4">
<h3><span class="header-section-number">4.4.4</span> A differential expression dot plot<a href="server.html#a-differential-expression-dot-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Colour intensity encodes the log2 fold change</li>
<li>Dot represents if the change is significant (filled) or not (unfilled).</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="server.html#cb16-1" aria-hidden="true" tabindex="-1"></a>plot_degplot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, x_var, y_var, col_var, shape_var){</span>
<span id="cb16-2"><a href="server.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-3"><a href="server.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  x_var <span class="ot">=</span> <span class="fu">enquo</span>(x_var)</span>
<span id="cb16-4"><a href="server.html#cb16-4" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">=</span> <span class="fu">enquo</span>(y_var)</span>
<span id="cb16-5"><a href="server.html#cb16-5" aria-hidden="true" tabindex="-1"></a>  col_var <span class="ot">=</span> <span class="fu">enquo</span>(col_var)</span>
<span id="cb16-6"><a href="server.html#cb16-6" aria-hidden="true" tabindex="-1"></a>  shape_var <span class="ot">=</span> <span class="fu">enquo</span>(shape_var)</span>
<span id="cb16-7"><a href="server.html#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="server.html#cb16-8" aria-hidden="true" tabindex="-1"></a>  degplot <span class="ot">=</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x=</span><span class="fu">interaction</span>(<span class="sc">!!</span>x_var), <span class="at">y =</span> <span class="sc">!!</span>y_var,</span>
<span id="cb16-9"><a href="server.html#cb16-9" aria-hidden="true" tabindex="-1"></a>                                      <span class="at">text =</span> <span class="fu">paste</span>(<span class="st">&#39;padj: &#39;</span>,padj))) <span class="sc">+</span></span>
<span id="cb16-10"><a href="server.html#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;viridis&quot;</span>, <span class="at">end =</span> .<span class="dv">90</span>) <span class="sc">+</span></span>
<span id="cb16-11"><a href="server.html#cb16-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col=</span><span class="sc">!!</span>col_var, <span class="at">shape=</span><span class="sc">!!</span>shape_var, <span class="at">size=</span><span class="fl">0.5</span>)) <span class="sc">+</span> <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">19</span>)) <span class="sc">+</span></span>
<span id="cb16-12"><a href="server.html#cb16-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">shape =</span> <span class="st">&quot;&quot;</span>, <span class="at">size =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">labels=</span>subpopulation_labels) <span class="sc">+</span> </span>
<span id="cb16-13"><a href="server.html#cb16-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">size =</span> <span class="st">&quot;none&quot;</span>)</span>
<span id="cb16-14"><a href="server.html#cb16-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-15"><a href="server.html#cb16-15" aria-hidden="true" tabindex="-1"></a>  degplot <span class="ot">=</span> degplot <span class="sc">+</span> <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-16"><a href="server.html#cb16-16" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-17"><a href="server.html#cb16-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>, <span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust=</span> <span class="dv">1</span>),</span>
<span id="cb16-18"><a href="server.html#cb16-18" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">10</span>),</span>
<span id="cb16-19"><a href="server.html#cb16-19" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.ticks.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb16-20"><a href="server.html#cb16-20" aria-hidden="true" tabindex="-1"></a>                        <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>(), <span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="fl">0.3</span>),</span>
<span id="cb16-21"><a href="server.html#cb16-21" aria-hidden="true" tabindex="-1"></a>                        <span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>, <span class="at">margin =</span> <span class="fu">margin</span>(<span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">6</span>, <span class="dv">2</span>)), </span>
<span id="cb16-22"><a href="server.html#cb16-22" aria-hidden="true" tabindex="-1"></a>                        <span class="at">panel.spacing =</span> <span class="fu">unit</span>(<span class="fl">0.25</span>, <span class="st">&quot;mm&quot;</span>)) </span>
<span id="cb16-23"><a href="server.html#cb16-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-24"><a href="server.html#cb16-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(degplot)</span>
<span id="cb16-25"><a href="server.html#cb16-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb16-26"><a href="server.html#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="server.html#cb16-27" aria-hidden="true" tabindex="-1"></a>degplot <span class="ot">=</span> <span class="fu">plot_degplot</span>(deg_df, Population, symbol, log2FoldChange, sig)</span>
<span id="cb16-28"><a href="server.html#cb16-28" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(degplot)</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
</div>
<div id="a-volcano-plot" class="section level3 hasAnchor" number="4.4.5">
<h3><span class="header-section-number">4.4.5</span> A volcano plot<a href="server.html#a-volcano-plot" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>showing case vs control samples</li>
<li>genes of interest are labelled using colour.</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="server.html#cb17-1" aria-hidden="true" tabindex="-1"></a>plot_volcanoplot <span class="ot">&lt;-</span> <span class="cf">function</span>(data, il_genes, x_var, y_var, label_var){</span>
<span id="cb17-2"><a href="server.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-3"><a href="server.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  x_var <span class="ot">=</span> <span class="fu">enquo</span>(x_var)</span>
<span id="cb17-4"><a href="server.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  y_var <span class="ot">=</span> <span class="fu">enquo</span>(y_var)</span>
<span id="cb17-5"><a href="server.html#cb17-5" aria-hidden="true" tabindex="-1"></a>  label_var <span class="ot">=</span> <span class="fu">enquo</span>(label_var)</span>
<span id="cb17-6"><a href="server.html#cb17-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-7"><a href="server.html#cb17-7" aria-hidden="true" tabindex="-1"></a>  volcanoplot <span class="ot">=</span> ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">data =</span> data, <span class="fu">aes</span>(<span class="at">x =</span> <span class="sc">!!</span>x_var, <span class="at">y =</span> <span class="sc">!!</span>y_var)) <span class="sc">+</span></span>
<span id="cb17-8"><a href="server.html#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;grey&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb17-9"><a href="server.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> il_genes, <span class="co"># New layer containing data subset il_genes</span></span>
<span id="cb17-10"><a href="server.html#cb17-10" aria-hidden="true" tabindex="-1"></a>               <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb17-11"><a href="server.html#cb17-11" aria-hidden="true" tabindex="-1"></a>               <span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb17-12"><a href="server.html#cb17-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> <span class="st">&quot;firebrick&quot;</span>,</span>
<span id="cb17-13"><a href="server.html#cb17-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-14"><a href="server.html#cb17-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="sc">-</span><span class="fu">log10</span>(<span class="fl">0.05</span>),</span>
<span id="cb17-15"><a href="server.html#cb17-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-16"><a href="server.html#cb17-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">c</span>(<span class="fu">log2</span>(<span class="fl">0.5</span>), <span class="fu">log2</span>(<span class="dv">2</span>)),</span>
<span id="cb17-17"><a href="server.html#cb17-17" aria-hidden="true" tabindex="-1"></a>               <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb17-18"><a href="server.html#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_label_repel</span>(<span class="at">data =</span> il_genes,</span>
<span id="cb17-19"><a href="server.html#cb17-19" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">aes</span>(<span class="at">label =</span> <span class="sc">!!</span>label_var),</span>
<span id="cb17-20"><a href="server.html#cb17-20" aria-hidden="true" tabindex="-1"></a>                     <span class="at">force =</span> <span class="dv">2</span>,</span>
<span id="cb17-21"><a href="server.html#cb17-21" aria-hidden="true" tabindex="-1"></a>                     <span class="at">nudge_y =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb17-22"><a href="server.html#cb17-22" aria-hidden="true" tabindex="-1"></a>    <span class="co"># scale_colour_manual(values = cols) +</span></span>
<span id="cb17-23"><a href="server.html#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">2</span>)),</span>
<span id="cb17-24"><a href="server.html#cb17-24" aria-hidden="true" tabindex="-1"></a>                       <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">10</span>, <span class="dv">10</span>)) <span class="sc">+</span> </span>
<span id="cb17-25"><a href="server.html#cb17-25" aria-hidden="true" tabindex="-1"></a>    <span class="co"># theme_line +</span></span>
<span id="cb17-26"><a href="server.html#cb17-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y=</span><span class="st">&quot;-log10(FDR)&quot;</span>)</span>
<span id="cb17-27"><a href="server.html#cb17-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-28"><a href="server.html#cb17-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(volcanoplot)</span>
<span id="cb17-29"><a href="server.html#cb17-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb17-30"><a href="server.html#cb17-30" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb17-31"><a href="server.html#cb17-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-32"><a href="server.html#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="server.html#cb17-33" aria-hidden="true" tabindex="-1"></a>res <span class="ot">=</span> <span class="fu">mutate</span>(deg, <span class="at">log10fdr=</span><span class="sc">-</span><span class="fu">log10</span>(padj))</span>
<span id="cb17-34"><a href="server.html#cb17-34" aria-hidden="true" tabindex="-1"></a>volc_df <span class="ot">=</span> res[res<span class="sc">$</span>symbol <span class="sc">%in%</span> genes,]</span>
<span id="cb17-35"><a href="server.html#cb17-35" aria-hidden="true" tabindex="-1"></a>volcanoplot <span class="ot">=</span> <span class="fu">plot_volcanoplot</span>(res, volc_df, log2FoldChange, log10fdr, symbol)</span>
<span id="cb17-36"><a href="server.html#cb17-36" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(volcanoplot)</span></code></pre></div>
<pre><code>## Warning: Removed 31279 rows containing missing values (`geom_point()`).</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
</div>
<div id="other" class="section level3 hasAnchor" number="4.4.6">
<h3><span class="header-section-number">4.4.6</span> Other<a href="server.html#other" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A downloadable R Markdown report can be generated by clicking the “Generate Code” button, as shown below.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="server.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download a R markdown report </span></span>
<span id="cb19-2"><a href="server.html#cb19-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>combineplot <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb19-3"><a href="server.html#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="st">&quot;RNAseq_homeplot.html&quot;</span>,</span>
<span id="cb19-4"><a href="server.html#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">content =</span> <span class="cf">function</span>(file) {</span>
<span id="cb19-5"><a href="server.html#cb19-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-6"><a href="server.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    params <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">matrix =</span> final_df, <span class="at">genes =</span> genes, <span class="at">sex =</span> input<span class="sc">$</span>sex, <span class="at">scRNA =</span> variables<span class="sc">$</span>pbmc, <span class="at">ratdeg =</span> degr,</span>
<span id="cb19-7"><a href="server.html#cb19-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mousedeg =</span> degm, <span class="at">humandeg =</span> degh,</span>
<span id="cb19-8"><a href="server.html#cb19-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">human_gene_data =</span> human_gene_data)</span>
<span id="cb19-9"><a href="server.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-10"><a href="server.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    shiny<span class="sc">::</span><span class="fu">withProgress</span>(<span class="at">value =</span> <span class="dv">0</span>,</span>
<span id="cb19-11"><a href="server.html#cb19-11" aria-hidden="true" tabindex="-1"></a>                        <span class="at">message =</span> <span class="st">&#39;Rendering plotting report&#39;</span>,</span>
<span id="cb19-12"><a href="server.html#cb19-12" aria-hidden="true" tabindex="-1"></a>                        <span class="at">detail =</span>  <span class="st">&#39;This might take several minutes.&#39;</span>,{</span>
<span id="cb19-13"><a href="server.html#cb19-13" aria-hidden="true" tabindex="-1"></a>                          rmarkdown<span class="sc">::</span><span class="fu">render</span>(<span class="at">input =</span> <span class="st">&quot;reports/combineplot.Rmd&quot;</span>,</span>
<span id="cb19-14"><a href="server.html#cb19-14" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">params =</span> params,</span>
<span id="cb19-15"><a href="server.html#cb19-15" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">output_file =</span> file,</span>
<span id="cb19-16"><a href="server.html#cb19-16" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">envir =</span> <span class="fu">new.env</span>(<span class="at">parent =</span> <span class="fu">globalenv</span>()))</span>
<span id="cb19-17"><a href="server.html#cb19-17" aria-hidden="true" tabindex="-1"></a>                        })</span>
<span id="cb19-18"><a href="server.html#cb19-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-19"><a href="server.html#cb19-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-20"><a href="server.html#cb19-20" aria-hidden="true" tabindex="-1"></a>) <span class="co"># closure for download handler</span></span></code></pre></div>
<p>The plots can also be downloaded as a zip file via a download button “Download Data”.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="server.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download all plots into a zip</span></span>
<span id="cb20-2"><a href="server.html#cb20-2" aria-hidden="true" tabindex="-1"></a>output<span class="sc">$</span>combineplots <span class="ot">&lt;-</span> <span class="fu">downloadHandler</span>(</span>
<span id="cb20-3"><a href="server.html#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">filename =</span> <span class="cf">function</span>() {</span>
<span id="cb20-4"><a href="server.html#cb20-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="st">&quot;combined&quot;</span>, <span class="st">&quot;zip&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>)</span>
<span id="cb20-5"><a href="server.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  },</span>
<span id="cb20-6"><a href="server.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-7"><a href="server.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">content =</span> <span class="cf">function</span>(file){</span>
<span id="cb20-8"><a href="server.html#cb20-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Set temporary working directory</span></span>
<span id="cb20-9"><a href="server.html#cb20-9" aria-hidden="true" tabindex="-1"></a>    owd <span class="ot">&lt;-</span> <span class="fu">setwd</span>(<span class="fu">tempdir</span>())</span>
<span id="cb20-10"><a href="server.html#cb20-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">on.exit</span>(<span class="fu">setwd</span>(owd))</span>
<span id="cb20-11"><a href="server.html#cb20-11" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> <span class="fu">c</span>()</span>
<span id="cb20-12"><a href="server.html#cb20-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-13"><a href="server.html#cb20-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Save the plots</span></span>
<span id="cb20-14"><a href="server.html#cb20-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="st">&#39;combine_deg.png&#39;</span>, <span class="at">plot =</span> combine_degplot, <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb20-15"><a href="server.html#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="st">&#39;combine_dot.png&#39;</span>, <span class="at">plot =</span> combine_dot, <span class="at">width =</span> <span class="dv">14</span>, <span class="at">height =</span> <span class="dv">6</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb20-16"><a href="server.html#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="st">&#39;scrna_dot.png&#39;</span>, <span class="at">plot =</span> scrna_dot, <span class="at">width =</span> <span class="dv">10</span>, <span class="at">height =</span> <span class="dv">8</span>, <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">units =</span> <span class="st">&quot;in&quot;</span>, <span class="at">device=</span><span class="st">&#39;png&#39;</span>)</span>
<span id="cb20-17"><a href="server.html#cb20-17" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;combine_deg.png&#39;</span>)</span>
<span id="cb20-18"><a href="server.html#cb20-18" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;combine_dot.png&#39;</span>)</span>
<span id="cb20-19"><a href="server.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&#39;scrna_dot.png&#39;</span>)</span>
<span id="cb20-20"><a href="server.html#cb20-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-21"><a href="server.html#cb20-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># csv files for gene count data</span></span>
<span id="cb20-22"><a href="server.html#cb20-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">write.csv</span>(final_df,<span class="st">&quot;result_table.csv&quot;</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">col.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-23"><a href="server.html#cb20-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-24"><a href="server.html#cb20-24" aria-hidden="true" tabindex="-1"></a>    fs <span class="ot">=</span> <span class="fu">c</span>(fs, <span class="st">&quot;result_table.csv&quot;</span>)</span>
<span id="cb20-25"><a href="server.html#cb20-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-26"><a href="server.html#cb20-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">zip</span>(file, fs)</span>
<span id="cb20-27"><a href="server.html#cb20-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-28"><a href="server.html#cb20-28" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ui.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="deploy.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
